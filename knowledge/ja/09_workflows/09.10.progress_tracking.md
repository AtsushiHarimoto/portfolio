# 大規模タスク進捗追跡メカニズム

> **種類**: ワークフロー (Workflow) / ツーリング技法
> **日付**: 2026-01-11
> **出典**: 会話 - タスク管理システム構築

---

## 概要

高トークン (Token) 消費量や多数のファイルにまたがる大規模タスクに対し、自動化された規模評価、バッチ実行戦略、リアルタイム進捗追跡を実装し、トークンオーバーフローとタスク暴走のリスクを防止します。

---

## 背景

### 歴史的課題

大規模タスク実行時に頻繁に発生するボトルネック：

1. **トークンオーバーフロー (Token Overflow)**：単一実行でファイルが多すぎ、コンテキストのトークン上限を超過。
2. **進捗ブラインドスポット**：タスクの進行状況をリアルタイムで観察できない。
3. **低い耐障害性**：タスク途中でクラッシュすると最初からやり直し。
4. **予測不能な所要時間**：完了までの時間を見積もる定量指標がない。

---

## 詳細設計

### 自動化規模評価

タスク開始前に AI が強制的に規模事前評価を実行：

```typescript
interface TaskEstimate {
  type: "small" | "medium" | "large";
  estimatedFiles: number;
  estimatedTokens: number;
  suggestedBatches: number;
}
```

**評価基準**：
- **Small**: <= 5 ファイル、推定 < 20k トークン -> シングルパス実行。
- **Medium**: 6-15 ファイル、推定 20k-50k トークン -> オプションのバッチ実行。
- **Large**: > 15 ファイル、推定 > 50k トークン -> **バッチ実行を強制/強く推奨**。

---

### 進捗トラッカーファイル構造

**ファイル格納パス**: `workspace/progress/{TASK_ID}_1.progress.md`

**テンプレート**：

```markdown
# {タスク名} - 実行進捗トラッカー

## 全体ステータス
- 現在の状態: 実行中
- 進捗: 25%（1/4 バッチ完了）
- 開始時刻: 2026-01-11 02:00
- 推定完了: 2026-01-11 04:30

## バッチ詳細

### Batch 1/4 - コア基盤モジュール（完了）
- 対象ファイル: Button.vue, Input.vue, Select.vue
- トークン消費: ~18k
- 実績時間: 15 分
- ステータス: 完了

### Batch 2/4 - レイアウトコンポーネント（進行中）
- 対象ファイル: Layout.vue, Grid.vue, Flex.vue
- トークン消費: ~20k
- ステータス: 実行中（2/3 ファイル完了）

### Batch 3/4 - フォームインタラクションコンポーネント（待機中）
- 対象ファイル: Form.vue, FormItem.vue, Checkbox.vue
- トークン消費: ~22k
- ステータス: 待機

### Batch 4/4 - ドキュメント・ナレッジベース整合（待機中）
- 対象ファイル: README.md, CHANGELOG.md, docs/
- トークン消費: ~20k
- ステータス: 待機
```

---

### バッチ分割戦略

#### ガイドライン原則
1. **モジュール凝集性**：強い関連性と依存性を持つファイルは同一バッチに。
2. **負荷分散**：各バッチのトークン消費を平均値に近づけ、単一バッチの過負荷を回避。
3. **依存性順序**：「コア基盤 -> 依存モジュール -> エッジアプリケーション」の実装順序を厳守。
4. **ドキュメント後回し**：ソースコードロジック完了後の最終バッチでドキュメント更新。

---

### リアルタイムフィードバック更新メカニズム

各バッチ完了時、システムが進捗ファイルを自動更新：
1. **ステータスインジケータ遷移**：待機 -> 実行中 -> 完了。
2. **パーセンテージ再計算**：完了バッチに基づき全体パーセンテージを正確計算。
3. **時間監査**：各バッチの実績時間を正確記録。
4. **時間収束予測**：完了バッチの平均スループットに基づき推定完了時刻を動的校正。

---

## コアメリット

1. **制御可能性 (Controllability)**：バッチ実行によりトークン爆発によるシステムメモリ喪失・クラッシュを回避。
2. **可視性 (Visibility)**：ユーザーにリアルタイムの全体ビューを提供し「ブラックボックス」不安を解消。
3. **回復可能性 (Recoverability)**：特定バッチで障害が発生しても、そのバッチのみリセットで既完了分は影響なし。
4. **予測可能性 (Predictability)**：動的完了時刻推定でプロジェクトマネージャーに正確な時間感覚を提供。
5. **追跡可能性 (Traceability)**：ログトレイルファイルが将来の最適化やデバッグ調査の重要参照に。

---

## 注意事項

- **バッチあたり負荷制限**：単一バッチのトークン負荷は 30k 安全ラインを厳守。
- **依存順序は不可逆**：アプリケーション層を基盤層より先に処理する逆転ミスを厳防。
- **即時書き込み**：各バッチ完了チェックポイントで直ちにファイルシステムにステータスをコミット。
- **アーカイブ規律**：`workspace/progress/` でタスクを放置しない。完了後は必ずアーカイブ移動。
- **干渉最小化**：Large 閾値トリガー時のみ有効化し、不要なシステムダイアログ負荷を回避。

---

_本ドキュメントはモジュール化メンテナンスシステムにより 2026-01-11 に自動生成されました_
