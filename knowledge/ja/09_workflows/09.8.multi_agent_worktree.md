# マルチエージェント隔離開発手法 (Parallel Universe)

> 種類：ベストプラクティス
> 日付：2026-01-19

## 背景

マルチエージェント (Antigravity/Codex/Claude) 協業シナリオにおいて、すべてのエージェントが同一の物理ディレクトリで操作すると、以下の問題が発生しやすくなります：

- ファイルロック (File Lock) の競合。
- `git index` ステータスの混乱（ステージングエリア (Staging Area) のコンフリクト）。
- 一時ファイルの相互上書き。
- 開発サーバー (Dev Server) のポート競合や依存関係の汚染。

## 結論

`git worktree` ベースの「パラレルユニバース (Parallel Universe)」モデルを採用し、**瞬時の環境隔離**を実現します。各エージェントが独立した物理ワークスペースを持ちながら、Git オブジェクトストアを共有します。

### コアメカニズム

1. **メインユニバース (Main)**：クリーンに保ち、最終コードのマージにのみ使用。
2. **パラレルユニバース (Worktree)**：各タスク（`/iso start task-name`）で独立ディレクトリ `.worktrees/<task-name>` を作成。
3. **環境クローン**：ルートディレクトリから `.env` を隔離ゾーンに自動コピーし、設定の一貫性を確保。
4. **収束メカニズム**：タスク完了時（`/iso finish`）、自動的に Main にマージしパラレルユニバースを破棄。

## 操作ガイド

### 1. Antigravity（`/iso` コマンド保有）

最高権限と便利な操作を備えています：

- **タスク開始**：`/iso start <task-name>`（ブランチ `agent/<task-name>` を自動作成）
- **タスク完了**：`/iso finish <task-name>`（自動マージ + 削除）
- **タスク中止**：`/iso drop <task-name>`（強制削除）

### 2. Codex / Claude（Skill を使用）

自然言語で `git-worktree-manager` Skill を呼び出します：

- **開始**: "Use git-worktree-manager to create a worktree for task 'api-fix'."
- **完了**: "Finish task 'api-fix', merge and cleanup."

## アクションアイテム

- [ ] **権限設定**：`.agent/skills`、`.codex/skills`、`.claude/skills` すべてに `git-worktree-manager` があることを確認。
- [ ] **除外設定**：`.gitignore` に `.worktrees/` を含める必要あり。
- [ ] **コンフリクト処理**：`/iso finish` でマージコンフリクト (Merge Conflict) が発生した場合、プロセスは一時停止。メインディレクトリで手動解決後に再度 Finish を実行。

## 参照

- Skill: `git-worktree-manager`
- Workflow: `/iso`
- Config: `workspace/knowledge/11.claude_code/11.3.skills_example.md`
