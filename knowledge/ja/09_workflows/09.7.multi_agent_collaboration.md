# マルチ AI エージェント協業フレームワーク設計

> **種類**: 技術判断 + ベストプラクティス
> **日付**: 2026-01-07
> **出典**: 会話 - マルチエージェント (Multi-Agent) 協業体制構築

---

## 概要

Claude（ソリューション設計）、Codex（コード監査）、Antigravity（実行エンジニア）の三者協業体制を確立します。本ドキュメントでは協業フロー、役割職責、およびこの体制を支える技術アーキテクチャ（Skills ライブラリと同期メカニズム）を定義します。

---

## 背景

従来の AI 支援開発では、単一の AI が要件分析からコード作成、テストまですべてを担当します。この単一ポイント運用は以下の問題を容易に引き起こします：

- **方向のずれ**：アーキテクチャ確認なしにコードを書き始め、頻繁な手戻りが発生。
- **品質のばらつき**：独立した監査ステップがなく、エンジニアリング規範の遵守が不均一。
- **追跡困難**：意思決定プロセスの構造化ドキュメントがなく、ナレッジギャップが発生。

本フレームワークは明確に定義された三者協業メカニズムにより、これらの問題を根絶します。

---

## 詳細設計

### 役割定義（2026-01 更新）

#### Claude - アーキテクト / 計画統括者

- **職責**：要件分析、システムアーキテクチャ設計、複雑な大規模タスク計画、コードレビュー監査。
- **強み**：高レベルのビジネス要件を高い実行可能性を持つ技術ブループリントに分解・設計。ソースコード品質を厳格にゲートキーピング。
- **アウトプット**：構造化提案ドキュメント（目標、影響範囲、実装ガイドライン、テスト・受入基準を含む）、レビューレポート。

#### Codex - バックエンド / データエンジニア

- **職責**：バックエンドビジネスロジック開発、データ変換処理、API エンドポイント実装・メンテナンス、データベース操作。
- **アウトプット**：バックエンドソースコード変更 + API 実装スクリプト + データアクセスロジック。

#### Antigravity - 運用管理者 / フロントエンド UI エンジニア

- **職責**：日常タスク管理、UI ビジュアル・機能実現、フロントエンジニアリング開発、高速プロトタイプイテレーション。
- **アウトプット**：フロントエンドソースコード変更 + カプセル化 UI コンポーネント + テスト成功証拠ログ + タスク完了レポート。

### 協業フロー

#### モード 1：要件駆動（Claude -> Antigravity）
```
ユーザー要件入力 -> Claude が技術ブループリント生成（workspace/plans/ にアーカイブ）-> Antigravity がブループリント読取 -> スコープ確認 -> コーディング実行 -> ステータス報告 -> コミット
```

#### モード 2：監査駆動（Codex -> Antigravity）
```
コード品質アラート発生 -> Codex がグローバル監査実施 -> 修正提案生成（workspace/plans/ にアーカイブ）-> Antigravity が修正実行 -> ローカル検証 -> コミット
```

#### モード 3：ハイブリッド高保証協業
```
Claude が初版設計 -> Antigravity が実装 -> Codex が品質監査 -> (問題あれば) Codex が修正チケット -> Antigravity が二次修正 -> テスト合格で完了
```

### 標準化プランフォーマット

Claude または Codex が提出するすべての提案は、以下の 4 セクション構造に従う必要があります：

```markdown
# [タスクタイトル]
## 1. コア目標
## 2. 影響スコープ
## 3. 実装詳細
## 4. 受入基準
- [ ] 検証可能な完了チェックリスト項目
```

---

## 技術アーキテクチャと Skills 体系

**SSOT (Single Source of Truth)** と**スマートコンテキストローディング (Smart Context Loading)** の 2 つの原則に基づきます。

### 1. スキルライブラリ設計

すべての AI コア能力は `.agent/skills/` で一元宣言（グローバル SSOT）。
- **`.claude/skills/`**：アーキテクト専用の同期コピー。
- **`.codex/skills/`**：監査/バックエンド専用の同期コピー。

### 2. 同期メカニズム

`sync-skills` 自動化スクリプトにより 3 エージェント間で対称的な能力定義と制約を確保。単一ポイント更新、マルチポイント反映。

### 3. スマートコンテキストローディング

SCOPE に基づき動的にルールをマウント：

| 対象 SCOPE      | 自動ロードルール              | 目的                                       |
| :-------------- | :---------------------------- | :----------------------------------------- |
| **API Project** | Core + TS Rules               | ビジネスロジックと型安全に集中             |
| **Frontend**    | Core + TS + Vue + Style Rules | ビジュアルトークンの一貫性を保証           |
| **QA Project**  | Core + Testing Rules          | テストケースの境界条件防護に集中           |

---

## シナリオ選択ガイド（2026-01 更新）

### Claude を呼ぶタイミング

- 新機能をゼロから設計、または複雑なアーキテクチャを分析する場合
- 言語横断/システム横断の技術選定評価が必要な場合
- グローバルリファクタリング戦略が必要な場合
- 本番デプロイ前の徹底的なコードレビューが必要な場合

### Codex を呼ぶタイミング

- バックエンド API ルートとエンドポイントロジック構築時
- 非同期データクレンジング・処理ロジック作成時
- SQL CRUD やデータマイグレーションスクリプト作成時
- データレース (Data Race) やデッドロック (Deadlock) のデバッグ時

### Antigravity を呼ぶタイミング

- デザインモックアップから精緻な UI/UX 機能構築時
- DOM 構造崩れや CSS バグの修正時
- 日常の定型開発タスクの管理・推進時
- MVP 高速プロトタイプの構築時

---

## コア防護と注意事項

- **提案構造の制式化必須**：目標、スコープ、実装詳細、受入基準の 4 セクションを確認。
- **パス参照の明確化必須**：相対的な曖昧パスは禁止。プロジェクトルートからの絶対パスを使用。
- **受入基準の計測可能化必須**：「性能向上」等の感性的表現を排除し、客観的・定量的テストポイントに置換。
- **タスクフローの統一化**：Antigravity は上流が Claude でも Codex でも `/claude_task` 経由で統一受付。

---

_本ドキュメントはモジュール化メンテナンスシステムにより自動生成されました_
