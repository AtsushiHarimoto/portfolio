# スキル（Skill）作成ガイド

> **タイプ**: 開発規範
> **日付**: 2026-02-26
> **ステータス**: スケルトン（Skeleton）
> **関連**: `07.2.claude_skills_structure.md`、`22_opencwal_principles.md`

---

## 概要

Claude Code スキル（Skill）は、再利用可能なプロンプト（Prompt）パッケージであり、エージェント（Agent）にドメイン知識と構造化ワークフローを注入します。本文では、スキルの設計原則、ファイルフォーマット、品質基準、ライフサイクル管理について定義します。

---

## 1. スキルとは何か

### 1.1 本質

Skill = **構造化されたコンテキスト（Context）注入パッケージ**（OpenCWAL L1-L2 参照）

```
トリガー条件 → スキル内容をロード → エージェントコンテキストに注入 → 行動をガイド
```

### 1.2 他の概念との違い

| 概念 | 役割 | 持続性 | トリガー方法 |
|------|------|--------|----------|
| CLAUDE.md | グローバル制約 | 常時ロード (L0) | 自動注入 |
| Skill | ドメインガイド | オンデマンド (L1) | 手動 / 条件マッチング |
| MCP Tool | 能力拡張 | 常時利用可能 | エージェントが自律的に呼び出し |
| Prompt Template | 入力テンプレート | 一回限り | ユーザーが選択 |

---

## 2. ファイルフォーマット

### 2.1 フロントマター（Frontmatter、必須）

```yaml
---
name: my-skill-name           # kebab-case、グローバルで一意
description: >
  用途とトリガー条件を一文で記述。
  Use when [トリガーシーン]。
---
```

### 2.2 構造テンプレート

```markdown
---
name: skill-name
description: 用途の簡潔な説明。Use when [トリガーシーン]。
---

## Context（背景）
なぜこのスキルが必要で、どんな問題を解決するのか。

## Rules（ルール）
エージェントが遵守すべき制約条件。

## Workflow（フロー）
1. ステップ 1
2. ステップ 2
3. ...

## Checklist（チェックリスト）
- [ ] 検収項目 1
- [ ] 検収項目 2

## Examples（例）
<example>
具体的な入出力の例
</example>

## Anti-patterns（アンチパターン）
- やってはいけないこと
- よくあるミス
```

---

## 3. 設計原則

### 3.1 核心原則

| # | 原則 | 説明 |
|---|------|------|
| 1 | **単一責任** | 1 つのスキルで 1 つの問題を解決する |
| 2 | **トリガーの明確化** | description にいつ使用するかを明確に記載 |
| 3 | **自己完結** | 他のスキルに依存せず単独で動作する |
| 4 | **テスト可能** | 明確な入力 → 出力の期待値がある |
| 5 | **トークン（Token）効率** | 2,000 トークン以内に収める（理想） |

### 3.2 命名規則

| タイプ | フォーマット | 例 |
|------|------|------|
| 汎用ワークフロー | `動詞-名詞` | `commit-work`, `review-pr` |
| ドメインガイド | `ドメイン-トピック` | `frontend-design`, `api-design` |
| プロジェクト専用 | `プロジェクト-機能` | `moyin-brand-guard` |

### 3.3 Description の書き方

```
OK: "Use when implementing frontend components. Ensures brand compliance and accessibility."
NG: "Frontend skill"
NG: "This skill helps with frontend stuff"
```

重要な要素：
- **いつ使うか** (Use when...)
- **何をするか** (Ensures / Guides / Validates...)
- **トリガーキーワード** で自動マッチング精度を向上

---

## 4. 品質基準

### 4.1 スキル品質チェックリスト

| 項目 | 基準 |
|------|------|
| Frontmatter | name + description が完全 |
| トリガー条件 | description に明確な "Use when" がある |
| プロセスステップ | 番号付きの Workflow または Checklist がある |
| 例 | 少なくとも 1 つの `<example>` ブロック |
| アンチパターン | 少なくともよくあるミスを列挙 |
| トークン長 | < 3,000 tokens（推奨） |
| 曖昧さの排除 | ルールに「必須 / 禁止」を使い「推奨 / 可能」を避ける |

### 4.2 Rigid vs Flexible

| タイプ | 特徴 | 例 |
|------|------|------|
| **Rigid** | ステップを厳密に実行する必要がある | TDD、デバッグ、コミット |
| **Flexible** | 原則ベースのガイド、状況に応じて適応可能 | design-patterns、frontend-design |

スキルの冒頭にタイプを記載し、エージェントに実行の柔軟性を伝えます。

---

## 5. 保管と管理

### 5.1 ディレクトリ構成

```
~/.claude/skills/
├── core/               # コアワークフロースキル
├── domain/             # ドメイン知識スキル
├── project/            # プロジェクト専用スキル
└── experimental/       # 実験的スキル
```

### 5.2 ライフサイクル

```
Draft → Review → Active → Deprecated → Archived
```

| ステージ | 条件 |
|------|------|
| Draft | 初版完成 |
| Review | 少なくとも 3 回の実運用で検証済み |
| Active | 安定して使用中 |
| Deprecated | より良い代替手段が存在する |
| Archived | `_archive/` に移動 |

### 5.3 バージョン同期

> リマインダー：`~/.claude/skills/` を変更した後は Git Remote に同期が必要です
> `git@github.com:AtsushiHarimoto/Moyin-Claude-skills-config.git`

---

## 6. よくあるアンチパターン

| アンチパターン | 問題 | 修正 |
|--------|------|------|
| 巨大スキル | > 5,000 tokens、注意力が分散 | 複数の小さなスキルに分割 |
| 曖昧なトリガー | description が広すぎて誤トリガー | 具体的なトリガー条件を追加 |
| 暗黙の依存 | 他のスキルがロード済みと仮定 | 必要な情報をすべて自己完結で含める |
| 例の欠如 | エージェントが期待される動作を把握できない | example ブロックを追加 |
| 過度な規定 | 制約が厳しすぎて変化に対応できない | Rigid / Flexible を区別 |

---

## 今後の深掘り項目

- [ ] スキルの自動テスト方式
- [ ] スキル間の組み合わせとオーケストレーションパターン
- [ ] スキルのパフォーマンス計測（トークン使用量、トリガー精度）
- [ ] OpenCWAL コンテキスト予算との統合
- [ ] スキルのバージョン管理とブレイキングチェンジ（Breaking Change）対応
