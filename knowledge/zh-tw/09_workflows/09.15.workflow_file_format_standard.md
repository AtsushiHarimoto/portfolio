# Workflow 文件格式規範

> **類型**: 最佳實踐  
> **日期**: 2026-01-03  
> **來源**: 對話 ID (2026-01-03 會話)

---

## 摘要

定義 `.agent/workflows/` 工作流文件的標準格式，包含 YAML frontmatter、步驟編號、turbo 標記、錯誤處理表和使用範例，確保工作流可執行且易於維護。

---

## 背景

工作流文件需要標準化格式，確保：

1. **可被 AI 識別和執行**
2. **步驟清晰且可追蹤**
3. **錯誤處理完整**
4. **用戶易於理解**

---

## 詳細內容

### 核心格式要求

#### 1. YAML Frontmatter（必須）

每個 workflow 文件必須以 YAML frontmatter 開頭：

```yaml
---
description: { 工作流簡短描述 }
---
```

**範例**：

```yaml
---
description: 開發 SOP
---
```

#### 2. 標題和目的（必須）

```markdown
# {工作流名稱}

## 目的

{詳細說明工作流的目的，1-3 段}
```

#### 3. SCOPE 路徑映射（若涉及多專案）

```markdown
## SCOPE 路徑映射

依據當前 SCOPE 選擇對應的工作路徑：

| 子項目  | 代碼根                    | 文檔根                 | Review 輸出                   |
| ------- | ------------------------- | ---------------------- | ----------------------------- |
| **API** | `projects/moyin-gateway/web2api` | `projects/moyin-gateway/docs` | `projects/moyin-gateway/docs/review` |

...
```

#### 4. 執行步驟（必須）

使用 `### Step N:` 格式：

```markdown
## 執行步驟

### Step 0: 確認當前 SCOPE

// turbo
{步驟描述}

**前置條件**：{若有}

**檢查項**：

- 檢查項 1
- 檢查項 2

**若發現問題**：

- 使用 `ASK:` 詢問用戶

**輸出**：{步驟輸出}

---

### Step 1: {步驟名稱}

{步驟描述}

**輸出**：{步驟輸出}
```

#### 5. Turbo 標記（可選）

若步驟可自動執行，加上 `// turbo` 標記：

```markdown
### Step 1: 掃描文件

// turbo
執行 `git status` 獲取變更文件清單。
```

#### 6. 停止條件（必須）

```markdown
## 停止條件

當以下任一條件滿足時，工作流結束：

1. {條件 1}
2. {條件 2}
3. {條件 3}
```

#### 7. 錯誤處理表（必須）

```markdown
## 錯誤處理

| 錯誤情況 | 處理方式     |
| -------- | ------------ |
| {錯誤 1} | {處理方式 1} |
| {錯誤 2} | {處理方式 2} |
```

#### 8. 使用範例（推薦）

```markdown
## 使用範例

### 範例 1：{場景描述}

**用戶輸入**：
```

/workflow-name

```

**AI 執行**：
1. {步驟 1}
2. {步驟 2}
3. {步驟 3}
```

#### 9. 注意事項（推薦）

```markdown
## 注意事項

1. **{注意事項 1}**：{詳細說明}
2. **{注意事項 2}**：{詳細說明}
```

---

## 代碼/命令範例

### 範例 1：完整 Workflow 文件結構

```markdown
---
description: 工作流簡短描述
---

# 工作流名稱

## 目的

{目的說明}

---

## SCOPE 路徑映射

{若涉及多專案}

---

## 執行步驟

### Step 0: 確認 SCOPE

// turbo
{步驟描述}

---

### Step 1: {步驟名稱}

{步驟描述}

---

## 停止條件

{停止條件清單}

---

## 錯誤處理

{錯誤處理表}

---

## 使用範例

{使用範例}

---

## 注意事項

{注意事項清單}
```

### 範例 2：Turbo 標記使用

```markdown
### Step 1: 掃描目錄

// turbo
掃描 `workspace/knowledge/` 下的所有分類目錄。

**輸出**：文件清單（按分類分組）。

---

### Step 2: 確認歸檔策略

**前置條件**：已掃描目錄。

**ASK 用戶**：

- 列出所有知識點及建議分類
- 詢問：「以上知識點分類是否正確？」

**輸出**：確認後的知識點分類。
```

### 範例 3：錯誤處理表

```markdown
## 錯誤處理

| 錯誤情況         | 處理方式                        |
| ---------------- | ------------------------------- |
| 未指定 SCOPE     | ASK 用戶確認子項目              |
| 文檔與代碼矛盾   | 輸出 review 報告並 ASK 修正策略 |
| Code Review 失敗 | 輸出 issues 並等待修復          |
| 跨 SCOPE 變更    | 拒絕並提示分開提交              |
```

---

## 適用場景

- **場景 1：建立新 Workflow**  
  使用本規範建立標準化的工作流文件。

- **場景 2：重構現有 Workflow**  
  將簡單列點改為詳細步驟 + turbo 標記 + 錯誤處理。

- **場景 3：Workflow Review**  
  檢查現有 workflow 是否符合本規範。

- **場景 4：文檔模板**  
  將本規範作為 workflow 文件的模板。

---

## 相關資源

- [run-dev.md](../../../.agent/workflows/run-dev.md) - 開發工作流範例
- [run-qa.md](../../../.agent/workflows/run-qa.md) - 測試工作流範例
- [run-archive.md](../../../.agent/workflows/run-archive.md) - 歸檔工作流範例
- [deliverables_jap.md](../../../.agent/workflows/deliverables_jap.md) - 日語成果物同步範例

---

## 注意事項

- ⚠️ **YAML frontmatter 必須在文件最開頭**  
  不得有任何空行或註釋在 `---` 之前。

- ⚠️ **步驟編號從 Step 0 開始**  
  Step 0 通常用於確認 SCOPE 或前置檢查。

- ⚠️ **Turbo 標記只適用於單個步驟**  
  若整個 workflow 都可自動執行，使用 `// turbo-all`。

- ⚠️ **錯誤處理表必須涵蓋常見錯誤**  
  至少包含 4-6 種錯誤情況。

- ⚠️ **使用範例必須可執行**  
  提供真實的命令和預期輸出。

---

_本文檔由 `/run-wiki conversation` 自動生成_
