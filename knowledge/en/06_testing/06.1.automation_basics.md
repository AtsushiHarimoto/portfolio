# 06.1. Moyin Automated E2E Testing Practice and Infrastructure Guide (Automation Basics)

> **Type**: Quality Assurance (QA) and Automated Testing Engineering
> **Focus**: Explains how to employ "Automation Bots (Playwright)" to replace traditional manual clicking, thoroughly eliminating Regression Bugs brought about by every refactoring. It also records the distinct white-box dynamic testing solutions unique to the Moyin project, breaking through the timing verification bottlenecks caused by game animation rendering.

---

## Prelude: What is Automated E2E Testing?

In fast-iterating and highly complex frontend applications (especially the visual novel engine core where the state tree piles up like a mountain), relying solely on human engineers to manually click and verify on a browser is not only extremely inefficient but also destined to generate many omitted blind spots.
What we need is a tireless, national-defense-grade fire blockade line‚Äîthis is the exact purpose of **Automated End-to-End Testing**.

### ü§ñ The Ghost Army in the Terminal: Playwright

The Moyin project appoints the renowned Web testing framework **Playwright**, which is equivalent to hiring an unpaid, 24/7 full-time bot tester, and writing down an operational code of conduct for it that it will never transgress:

1. Simulate the Chrome/Firefox core driving engine and access the test link.
2. Perform rigorous optical form scanning, track characteristic CSS tags, and then precisely press buttons just like a human.
3. Observe story transition effects, and verify the storage state at the save/load mechanism.
   The moment it notices at any millisecond that "the expected green checkmark box failed to render" or "the webpage encountered an unknown Fatal Error showing a white screen crash," it will faithfully record the log and ruthlessly hit the stop button on our CI (Continuous Integration) pipeline deployment.

### üëª The Hidden Headless Samurai (Headless Mode)

When you issue the test script command on your local machine, you will be surprised to find that "the browser window vanished out of thin air!"
Do not panic; this is the industry's top-tier **Headless Browser Mode**. By stripping away the surface UI graphic rendering logic that consumes the most graphics card resources, this headless bot can speed through executing dozens of script checks in the background terminal at god-like speeds (God-tier speed). If unfortunately, it encounters a red light error, it will not forget to take a high-definition screenshot as its dying photo for engineers to use for the autopsy.

---

## 2. Practical Tactics: Core Patents for Breaking Through Moyin's Engine Testing Bottlenecks

In Moyin's highly dynamic gaming environment, a purely black-box E2E bot can easily degrade into a blind patient. We developed the following two key stunts to make it unfailingly powerful:

### üîë Tactic 1: Dynamic Manifest Injection

**[Environmental Challenge]**:
Under the Moyin engine's architectural design, to prevent system corruption, the underlying layer will completely reject the secondary import of a story package with the same ID. This means if we pass the first round of testing, when executing the second round again, the bot will hit the error "The story file is already deadlocked and exists," causing the CI to lose its Idempotency for rerunning.

**[Hacker Solution]**:
Within Playwright's initial setup script Hooks, plant an interception and processing algorithm. We dynamically tamper with the Manifest credentials going to the database:

- Original Setting: `ID: Mock_Testing_Story`
- Dynamic Shuffling: `ID: Mock_Testing_Story_89f2_202611221430` (Injecting a random hash and system timestamp).
  This bait-and-switch operation creates memory fraud for the backend engine, treating every submission as a brand new, clean masterpiece loading. From then on, the test script achieved infinite bulletproof endurance.

### üåâ Tactic 2: Cross-Dimensional White-box Bridge

**[Environmental Challenge]**:
Because our VN (Visual Novel) stage is equipped with high-precision transition color rendering, if Playwright's black-box bot forcibly requests "please click the next line of dialogue" at this time, it often misses, clicking on the semi-transparent mask, ultimately triggering **Flaky Tests** due to waiting until a timeout. This is simply torturing our Devops team.

**[Hacker Solution]**:
We chose to no longer force the bot into playing blind man's bluff. The engineering team exclusively opened a global variable backdoor interface with high-level privileges during the Vue engine's build phase: `window.__MOYIN_TEST__`. This endows the bot with the X-ray superpower deeply rooted in the system core's spinal fluid:

- No need to rely on DOM tags; it can directly read Vuex / Pinia's deep variables to verify "whether the current stage pointer has entered Phase 4."
- When executing page turns, it no longer relies on simulating mouse clicks; it can directly overstep its authority to call core functions to forcefully cut off animations: `__MOYIN_TEST__.forceSkipNext()`.
  Cruelly eradicating the timing coupling brought about by animation lag, testing performance and stability have both achieved a mythic-level ascension!

---

## 3. Testing Orders and Post-Mortem Acceptance Reports (Execution & Post-Mortem)

As a member developer of this project, you do not necessarily need to possess the skill to write massive arrays of test cases, but you must learn how to awaken the troops, and when they are completely wiped out, find the casualty records:

### ‚öîÔ∏è Command Deployment Directives (Launch CLI)

By typing the following command in the terminal, immediately start all testing squads to sweep the environment:

```bash
npx playwright test
```

### üî¨ Post-Mortem and Crime Scene Investigation (Triaging the Results)

This system adheres to the principle of remaining silent unless reporting good news. Once you see the terminal log full of black-and-white text turn into a startled red error code, please sprint straight to:

- `tests/e2e/test-results/`: Enter this crime scene blockade line folder. Here, you can not only intercept the stack trace of the thrown fatal Exception, but you can also acquire the **on-scene high-resolution Screenshot / Video recording** filmed at the exact moment of the system crash. Through this evidence, you can quickly determine whether it's "refactoring CSS broke the layout causing the button to overflow the visible boundary" or a "core Router diversion paralysis triggering a dead machine white screen."

---

## üí° Vibecoding Instructions

When asking the AI agent to write E2E test cases for visual novels or games with complex front-end interactions:

> üó£Ô∏è `"When writing E2E tests for the engine using Playwright, you must use the [Cross-Dimensional White-box Bridge] method. Do not rely on unreliable DOM clicks to skip dialogue animations! Please directly call 'window.__MOYIN_TEST__.forceSkipNext()' to jump through the timeline. Also, when saving simulation data, ensure you implement [Dynamic Manifest Injection] by appending timelines and hashes to the ID to ensure the CI pipeline's Idempotency is indestructible!"`
