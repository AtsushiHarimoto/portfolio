# Cross-Agent Collaboration Guide: Best Practices from Claude Planning to Antigravity Execution

**Prerequisites**: You must have established system-level rule files (`.agent/rules/*.md`) and `AGENTS.md`, with all Agents strictly adhering to the following core disciplines:

- **Doc-First Principle**: Review specification documents before touching any code.
- **Approval Gate**: PLAN submitted -> Await authorization (OK) -> ACTION permitted only after approval.
- **Debugging Protocol**: When encountering anomalies (Bug/BG), present the evidence chain and root cause logic first, then propose a solution.
- **Delivery Verification**: Every execution result must include tamper-proof evidence (affected file list / terminal command output / result screenshots / manual verification checklist).

---

## 0) Universal Context Protocol: Standard Phrases for Efficient Task Initiation

### 0.1 Commands for Claude (Focus: Documentation Review / Requirements Clarification / Architecture Alignment)

- **Core Purpose**: Drive Claude to perform "documentation context review + extract system conflicts + produce a highly actionable PLAN."
- **Standard Input Template**:
  > `[PLAN Command] The current task aims to advance <feature name / issue>. The engineering scope is limited to <target subsystem directory>. Following the Doc-First principle, search existing docs (excluding system rule directories), identify conflicts between current state and documentation / architecture gaps. Final output should include: 1. Conflict inventory 2. Spec document revision recommendations 3. Downstream code implementation plan.`

**Claude Output Quality Checklist**:

- **DOC CHECK Verification Log**: Explicitly list all reviewed document paths.
- **Conflict and Gap Analysis**: Precisely identify which document clauses diverge from current system logic (with exact file paths and sections).
- **Implementation Plan (PLAN)**: Sequentially list execution steps, potential impact boundaries, operational risks, and verification criteria.
- **Blocking Point Confirmation**: If document restructuring is involved, the system must pause here and wait for user approval (OK). Absolutely no premature code writing.

### 0.2 Handoff Commands for Antigravity (Focus: Code Implementation and Test Engineering)

- **Core Purpose**: Seamlessly translate Claude's converged architecture decisions into execution tickets that Antigravity can directly consume.
- **Standard Input Template**:
  > `[PLAN Handoff] Below is the DOC CHECK verification log, conflict inventory, and finalized implementation blueprint from the planning layer (Claude). Please strictly follow system rules for the work procedure: First, restate your understanding of the task + list the file change matrix with paths + design verification commands. No ACTION phase may begin without my OK reply.`
  > (Then paste Claude's output: document reference list, conflict breakdown, implementation step matrix, test verification strategies, etc.)

**Antigravity Collaboration Rhythm**:

- Antigravity parses and delivers an implementation PLAN -> User reviews and issues `OK` -> ACTION permission unlocked.
- After implementation -> User only needs to verify objective Evidence (file change list / command execution logs) to decide whether to accept.

---

## 1) Software Development Scenario (RUN-DEV): New Feature Development

### 1.1 Planning Phase (Claude): Architecture-First Document Alignment

**Issue Command**:

- > `[PLAN Start] New feature module: <xxx>. Scope locked to: projects/<target subsystem>. Initiate Doc-First: search docs directory (exclude rule folders) -> distill core requirements -> identify architecture conflicts and gaps -> produce "document revision draft" and "code implementation + verification plan".`

**Expected Output**:

- Report filed at `docs/review/issues/<date>_feature_xxx.md` (or presented in standardized format within the conversation).
- Section-level revision proposals for documentation defects, strictly without touching any source code.

### 1.2 Execution Phase (Antigravity): Implement from Approved Blueprint

**Issue Command**:

- > `[PLAN Handoff] Follow the approved Claude plan to begin implementation. Strict constraint: only modifications within <subsystem source directory> are permitted; upon completion, present Evidence (including test commands and success logs). Present your execution PLAN first and await approval.`

**Acceptance Cycle**:

- Reply `OK` -> Authorize Antigravity to proceed with ACTION.
- Acceptance focuses on: correctness of changed file paths, effectiveness of executed commands, and key log excerpts.

---

## 2) Bug Investigation Scenario (RUN-DEV): Bug Analysis and Log Interpretation (BG)

### 2.1 Planning Phase (Claude): Precise Root Cause Identification and Spec Alignment

**Issue Command**:

- > `[BG Investigation] Observed anomalous behavior: <paste log excerpt or reproduction steps>. Scope narrowed to: <affected subsystem>. Initiate root cause analysis (provide direct evidence chain: pinpoint problematic source code blocks and conflicting documentation clauses) -> List candidate root causes ranked by probability -> Propose minimal fix under the constraint of "no changes to existing product requirements" -> Define corresponding verification steps.`

**Expected Output Highlights**:

- **Evidence Chain**: Explicitly identify the core function or call stack where the issue occurs.
- **Spec Verification**: Check whether existing documentation defines expected behavior for this scenario.
- **Fix Plan**: The most surgically precise minimal code change, with accompanying test coverage points.

### 2.2 Execution Phase (Antigravity): Apply the "Minimal Fix" Principle

**Issue Command**:

- > `[BG Handoff] Root cause analysis report and minimal fix blueprint follow. First, restate the root cause logic and code intervention boundaries, produce an execution PLAN including verification commands, and await the approval command ('OK') before starting ACTION.`

---

## 3) Quality Assurance Scenario (RUN-QA): Building Automated E2E / Regression Test Safety Nets

### 3.1 Planning Phase (Claude): Translate Requirements into "Testable Specifications"

**Issue Command**:

- > `[PLAN Start] Build a white-box E2E (or Smoke) test defense for <specific feature/module>. Follow Doc-First: scan docs (skip rule packages) -> enumerate test_cases specification matrix (must include precondition assertions / execution steps / expected states / coverage blind spots) -> expose currently untestable areas or missing test cases -> produce complete test design blueprint (archived to tests/docs).`

### 3.2 Execution Phase (Antigravity): Test Framework First, Actual Tests Second

**Issue Command**:

- > `[PLAN Handoff] Based on the test_cases specification matrix, first establish test file scaffolding and test case documentation. Once the scaffolding is stable, fill in actual test scripts. Safety rail: present your PLAN first (files to generate / test commands / expected coverage targets), confirm approval before ACTION. Each ACTION completion must deliver an Evidence package with commands and logs.`

---

## 4) Ultimate Agent Handoff: Building a "Tamper-Proof Minimal Transfer Package"

Conclusions obtained from Claude should be modularized into the following 5 structural blocks before being handed off to Antigravity. This completely eliminates the risk of Antigravity going rogue with speculative "divergent coding":

1. **Scope Lock**: Explicitly bind the target subsystem and corresponding directories that may be operated on.
2. **Doc Check Result**: Specify which specification documents this change is based upon.
3. **Gap & Conflicts**: Disclose each discrepancy between spec and current state, with section anchors.
4. **Finalized Plan**: Decompose into linear, irreversible operation steps.
5. **Verify Strategy**: Define specific shell commands or manual verification checklists to execute.

---

## 5) Human Commander's Boundary Control (The Human's Minimal Safety Net)

In a multi-Agent collaboration system, each role's function must be crystal clear:

- **Claude**: Responsible for "requirements translation, architecture document alignment, Review auditing, and Issue alert generation."
- **Antigravity**: Responsible for "code refactoring, command environment operations, and test engineering execution."
- **Decision Maker (Your Role)**: Focus on three critical safety net functions:
  1. **Plan Approval**: Only approve PLANs that comply with system constraints. Never pay for AI's unauthorized code divergence.
  2. **Evidence Verification**: Coldly evaluate only "result logs (Evidence) and actual command output." Do not debate with the AI about the "reasonableness of speculative logic."
  3. **Stop-Loss Restart (RETAKE)**: If communication diverges for more than 3 rounds without converging on a standard solution, decisively issue a RETAKE command (forcibly narrow the scope or decompose the main objective into smaller sub-tasks).

---

## 6) Minimal Control Elements (One-Liner Commands): Maximizing Token Cost-Effectiveness

- **Drive new feature development**:
  > `[PLAN] Core objective=<...> System boundary=<...> Initiate Doc-First, submit document conflict analysis and code implementation plan first.`
- **Start bug investigation**:
  > `[BG] Surface anomaly=<...> Reproduction path=<...> Hard requirement: present complete evidence chain + probability-ranked candidates + absolutely minimal fix code.`
- **Force strategic pivot**:
  > `[RETAKE] Current analysis direction has drifted from focus=<...> Force redirect to original boundary=<...> Withdraw previous assumptions, resubmit clean PLAN.`
- **Strict scope defense**:
  > `[PLAN] This operation carries the highest restriction: only the <projects/xxx> module may be modified. All other system-wide components are unconditionally locked.`
- **Version commit gate**:
  > `[COMMIT] Preparing to package version. First list: change summary matrix + impact assessment + automated test verification results. System is prohibited from triggering git commit without my OK.`
