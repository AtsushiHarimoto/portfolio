# 08. Moyin MCP Architecture

## MCP Server Architecture Diagram

`moyin-mcp-server` serves as the central dispatch hub, connecting the frontend UI with various backend rendering services.

```mermaid
graph LR
    subgraph "Frontend (Vue 3)"
        WebUI[Drama Studio UI]
    end

    subgraph "MCP Core (FastAPI)"
        API[API Endpoints]
        WS[WebSocket / PubSub]
        Celery[Celery Dispatcher]
    end

    subgraph "Storage"
        Redis[(Redis / Cache)]
        DB[(MongoDB / StoryPacks)]
    end

    subgraph "Workers (Distributed)"
        TTS[TTS Worker]
        Comfy[ComfyUI Worker]
        Video[Video Render Worker]
    end

    WebUI <-->|HTTP/WS| API
    API <--> WS
    WS <--> Redis
    API <--> Celery
    Celery --> TTS
    Celery --> Comfy
    Celery --> Video

    style API fill:#ccf,stroke:#333
    style WS fill:#ccf,stroke:#333
    style Redis fill:#f9f,stroke:#333
    style Comfy fill:#f96,stroke:#333
```

## Communication Protocols

- **Command Channel**: Used for sending production commands (e.g., `start_render`).
- **Status Sync**: Real-time status synchronization based on Redis PubSub; the frontend UI listens for task progress.
- **Data Sync**: Uses `StoryPack` as the data exchange format between nodes.
