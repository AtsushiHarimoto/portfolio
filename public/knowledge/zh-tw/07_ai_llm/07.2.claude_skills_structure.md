# 07.2. Claude Code 技能擴充結構規範 (Skills Directory Structure)

> **類型**: 工具技巧與 AI 環境建置  
> **日期**: 2026-01-11 (修訂: 2026-02-01)  
> **重點**: 詳述 Claude Code 及 Antigravity 之外部技能包 (Skills) 的正確資料夾結構與 YAML 詮釋資料 (Frontmatter) 規定，以確保基於 `@` 修飾符之觸發機制能正常掛載。

---

## 前言與核心謬誤修正

傳統理解中，開發者極易誤將所有的技能與工作流彙整至單一 Markdown 檔案內（例如：建立 `.claude/skills/workflows.md`，並期望能以 `@workflows` 觸發全域腳本），此種 **「單檔集中式」** 設計是完全錯誤的。

**正確的架構鐵律**：
為確實支援獨立的 `@skill_name` 觸發，每個獨立的外部技能 (Skill) 必須**自帶專屬的實體目錄**。

- **Antigravity (主開發平台，標準來源 SSOT)**: 所有的技能包請建置於 `.agent/skills/` 之下。
- **Claude Code**: 位於 `.claude/skills/`（日常開發中可透過執行 `/sync-skills` 工作流，將上述主庫內容同步覆寫過來）。

---

## 標準技能目錄結構 (Standard Directory Layout)

請參照下方 `handoff` 與 `new_issue` 等技能之標準目錄結構配置：

```text
.agent/skills/          # (Antigravity 主目錄)
├── handoff/            # [各別技能之獨立目錄]
│   ├── SKILL.md        # 必備：技能之主說明檔
│   └── TEMPLATE.md     # 選擇性：輔助模板或其他上下文檔案
│
├── new_issue/          # 對應 @new_issue 觸發
│   └── SKILL.md
│
├── inbox/              # 對應 @inbox 觸發
│   └── SKILL.md
│
└── dev/                # 對應 @dev 觸發
    └── SKILL.md
```

### 為什麼強制推行層級目錄設計？

1. **支援多檔案耦合**：諸多高階技能（如工作交接 `handoff`）除卻主要腳本外，尚需伴隨配置檔或輸出模板，目錄結構方能保持封裝完整性。
2. **目錄級別識別機制**：Antigravity 底層之掃描引擎，係直接走訪 `.agent/skills/` 目錄下的**第一層子目錄**，將目錄名稱視為註冊金鑰，並擷取其內之 `SKILL.md` 建立快取。

---

## SKILL.md 內部文檔撰寫規範 (Document Specification)

每個技能專屬目錄下，必須存在名為 `SKILL.md` 的主文件。且該文件之頂部**絕對必須包含 YAML Frontmatter 區塊**。

```markdown
---
name: new_issue
description: "協助使用者建立新的 ISSUE 任務追蹤實體。觸發方式：@new_issue"
---

# 建立全新任務 Issue (new_issue)

## 技能用途

本技能協助 AI 代理標準化地於 `workspace/issues/` 下產生追蹤檔...

## 觸發方式與機制

於對話框中輸入：
`@new_issue`

## 預期工作流 (Workflow)

...
```

### 詮釋資料 (Frontmatter) 查核要點

- `name`: 必須精準吻合外層目錄之命名（此將註冊為觸發指令）。
- `description`: 必須以一至兩句精煉總結功能，**且末段務必明文附上觸發方式**（例如："觸發：@xxx"）。若欠缺觸發提示字元，底層引擎將予以捨棄註冊。

---

## 遷移與除錯指南 (Migration & Troubleshooting)

倘若您的系統仍遺留有舊制的單檔結構，請遵循下列腳本邏輯進行平移（此處以 PowerShell 為例）：

### 錯誤的單檔狀態清掃

```powershell
# 強制銷毀不合規之單體檔案
Remove-Item ".claude/skills/workflows.md" -Force
```

### 重建合規之樹狀層級

```powershell
# 依據技能名稱重新配備實體目錄
New-Item -Type Directory ".claude/skills/new_issue" -Force
New-Item -Type Directory ".claude/skills/inbox" -Force

# (請接續於上述新建目錄中編寫各別的 SKILL.md)
```

### ❌ 常見報錯分析

- **錯誤 1：多層級巢狀埋藏**
  - 【錯誤寫法】 `.claude/skills/workflows/new_issue/SKILL.md`
  - 【解法】 掃描引擎不會遞迴深入！請嚴格遵循扁平化之單層子目錄結構： `.claude/skills/new_issue/SKILL.md`。
- **錯誤 2：YAML 區塊漏植**
  - 【錯誤寫法】 檔案一開頭直接書寫 `# new_issue`，無視 `---` 分界。
  - 【解法】 缺乏 `name` 鍵值對之檔案，系統將判定為一般文件而拒絕掛載，請即刻補齊 YAML Frontmatter。

---

## 關聯參考與擴展維護

- 當透過 IDE 修改完畢主體庫 `.agent/skills/` 內之代碼，若須確保外部純文字指令端 (Claude Code) 同步生效，請隨時呼叫 `/sync-skills` 工作流腳本以完成熱更新。
