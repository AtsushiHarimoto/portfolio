# 08. Moyin MCP Architecture

## ğŸ› MCP Server æ¶æ§‹æ¶æ§‹åœ–

`moyin-mcp-server` ä½œç‚ºæ ¸å¿ƒèª¿åº¦ä¸­æ¨ï¼Œé€£æ¥äº†å‰ç«¯ UI èˆ‡å¾Œç«¯å„é¡æ¸²æŸ“æœå‹™ã€‚

```mermaid
graph LR
    subgraph "Frontend (Vue 3)"
        WebUI[Drama Studio UI]
    end

    subgraph "MCP Core (FastAPI)"
        API[API Endpoints]
        WS[WebSocket / PubSub]
        Celery[Celery Dispatcher]
    end

    subgraph "Storage"
        Redis[(Redis / Cache)]
        DB[(MongoDB / StoryPacks)]
    end

    subgraph "Workers (Distributed)"
        TTS[TTS Worker]
        Comfy[ComfyUI Worker]
        Video[Video Render Worker]
    end

    WebUI <-->|HTTP/WS| API
    API <--> WS
    WS <--> Redis
    API <--> Celery
    Celery --> TTS
    Celery --> Comfy
    Celery --> Video

    style API fill:#ccf,stroke:#333
    style WS fill:#ccf,stroke:#333
    style Redis fill:#f9f,stroke:#333
    style Comfy fill:#f96,stroke:#333
```

## ğŸ“¡ é€šè¨Šå”è­°

- **Command Channel**: ç”¨æ–¼ç™¼é€ç”Ÿç”¢æŒ‡ä»¤ï¼ˆå¦‚ `start_render`ï¼‰ã€‚
- **Status Sync**: åŸºæ–¼ Redis PubSub çš„å¯¦æ™‚ç‹€æ…‹åŒæ­¥ï¼Œå‰ç«¯ UI æœƒç›£è½ä»»å‹™é€²åº¦ã€‚
- **Data Sync**: ä½¿ç”¨ `StoryPack` ä½œç‚ºå„ç¯€é»é–“çš„æ•¸æ“šäº¤æ›æ ¼å¼ã€‚
