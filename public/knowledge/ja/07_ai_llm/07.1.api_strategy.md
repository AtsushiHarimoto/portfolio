# 07.1. AI Galgame 引擎 LLM API 演進與商業變現策略

> **類型**: 架構演進與商業策劃  
> **重點**: 針對長文本互動解謎與 Galgame 場景，探討大語言模型 API 之選型、記憶力瓶頸破除及產品化路徑。

---

## 核心技術挑戰：無狀態協定與 Token 爆炸

在構建互動式視覺小說或 AI 驅動對話遊戲時，開發者會面臨以下根本性挑戰：

1. **官方付費 API (Official APIs)**:
   - **特性**：基於 RESTful 之無狀態 (Stateless) 協定。
   - **挑戰**：為確保 NPC 行為符合前情提要，每次發起請求皆須夾帶完整歷史對話與世界觀設定檔 (Lore)。隨遊戲時長推演，輸入端 (Input Tokens) 將呈指數級膨脹，導致推理成本失控與嚴重的網路延遲。
2. **網頁端逆向 API (Web Reverse-engineered API)**:
   - **特性**：利用網頁版原生 Session 架構維持有狀態 (Stateful) 記憶。
   - **優勢**：可突破 Token 計費限制，支援龐大上下文。
   - **風險**：極不穩定，易遭遇平台風控阻斷 (HTTP 403 Forbidden)，長期維護成本極高。

---

## 遊戲引擎架構演進路線圖 (Architecture Roadmap)

為在「運營成本」、「玩家體驗」與「系統防護力」間取得最佳平衡，Moyin 遊戲引擎的 LLM 接入策略劃分以下三階：

### v0：狀態機與滾動摘要 (State Machine & Rolling Summary)

- **運作機制**：遊戲引擎主動介入記憶管理。維護一組結構化狀態設定 (`state.json`)，配以壓縮過的「動態滾動摘要 (`summary`)」，並僅保留最近 N=8 輪的對話紀錄 (`recent_dialogue`) 提交給 LLM。
- **架構收益**：精準控制 Input Tokens 於常數級距，徹底根除成本隨遊玩時數線性增長的問題。
- **輸出規格**：強制 LLM 返回嚴格的 JSON 格式（其中須包含 `narrative` 旁白、`choices` 分支、以及 `state_delta` 狀態變更）。

### v1：控制層與寫手層之解耦 (Controller-Writer Pattern)

- **運作機制**：導入雙模型協作路由。前置部署一個輕量級推理模型 (Controller)，後端隱藏具備深度情感揣摩之頂規模型 (Writer，如 Gemini Pro / Claude 3.5)。
- **職責劃分**：Controller 專職判定玩家輸入意圖，按需檢索並動態注入局部世界觀 (Lore) 區塊，乃至過濾無意義對話，最終再決定是否觸發昂貴的 Writer 模型撰寫劇情。
- **架構收益**：透過漏斗式攔截，極大化降低頂級推理模型的調用頻度與所需之上下文負載。

### v2：全域在地化推理 (Fully Localized Deployment)

- **運作機制**：在玩家機端部署 7B~8B 級別之開源中文敘事推理模型 (如 Llama-3-8B-Instruct, Qwen-2.5 等)，並透過 `llama.cpp` (以 GGUF Q4_K_M 量化格式) 進行高效本地推理。
- **系統交互**：遊戲客戶端內建輕量化之 Local LLM Server，對外提供相容於 OpenAI 規格之串接介面，達成 100% 斷網離線遊玩。
- **架構收益**：
  - **零 API 成本**：徹底擺脫雲端 Token 訂閱制計費。
  - **隱私極致保護**：玩家對話資料絕不出境，消除合規審查風險。
  - **超低延遲**：借助玩家之消費級顯卡 (如 RTX 30/40 系列)，實現毫秒級串流生成體驗。
- **實務限制與解法**：本地端模型受限於硬體，上下文視窗必須更趨保守 (N=6，摘要限縮於 200~500 tokens)，且更依賴引擎端的 `state_delta` JSON 進行嚴謹狀態流轉。

---

## 商業變現與營運策略 (Commercialization Strategy)

### 階段一：MVP 最小可行性產品 (Market Validation)

- 導入「無感劫持/注入 (Cookie Capture)」等授權技術，允許玩家綁定其個人免費用戶之 Web 服務，大幅拉低遊戲的雲端伺服器營運成本，迅速測水溫與拓展社群流量。

### 階段二：自帶金鑰模式 (BYOK - Bring Your Own Key)

- 轉向以「銷售單機啟動器與引擎內核」為核心商業模式。玩家需於設定頁面綁定個人申請之雲端 API 金鑰 (如 Gemini / Claude)。
- **核心賣點 (USP)**：消費者實質購買的是 Moyin 開發團隊精心淬鍊之 **Prompt 框架**、**封閉式記憶管理演算法**與**獨家劇情模組**，而非底層語言能力本身。

### 階段三：合規與隱私免責聲明 (Compliance & Disclaimer)

- 必須於軟體端點 (EULA) 清楚載明：本服務之中樞依賴外部雲端推論，惟所有歷史對話 Token 陣列僅存留於玩家本機，絕無後台上傳或伺服器備份。
- 若伺服器端發生不可抗力之連線異常，開發商僅負修復客戶端橋接之責，對第三方模型商之限制免責。

---

_本文檔隸屬於 Moyin 專案商業與技術藍圖，旨在確保團隊對 LLM 串接方向與產品化終局具備一致認知。_
