# 07.1. AI ギャルゲーエンジンの LLM API の進化と商業化・収益化戦略

> **種類**: アーキテクチャの進化と商業計画
> **重点**: 長文テキストによるインタラクティブな謎解きやギャルゲー (Galgame) のシナリオに焦点を当て、大規模言語モデル (LLM) API の選定、メモリ (記憶) ボトルネックの突破、および製品化への道筋を探求します。

---

## コア技術課題：ステートレスプロトコルとトークン爆発

インタラクティブなビジュアルノベルや AI 駆動の対話ゲームを構築する際、開発者は以下の根本的課題に直面します：

1. **公式有料 API (Official APIs)**:
   - **特性**：RESTful ベースのステートレス (Stateless) プロトコルに基づきます。
   - **課題**：NPC の行動が前回までのコンテキストに沿うようにするため、毎回のリクエストで完全な会話履歴とワールドビルディング設定 (Lore) を含める必要があります。ゲームプレイ時間の経過とともに、入力トークン (Input Tokens) は指数関数的に膨張し、推論コストの制御不能と深刻なネットワーク遅延を引き起こします。
2. **Web リバースエンジニアリング API (Web Reverse-engineered API)**:
   - **特性**：Web 版のネイティブ Session アーキテクチャを利用してステートフル (Stateful) な記憶を維持します。
   - **利点**：トークン課金制限を突破し、大規模なコンテキストウィンドウをサポートできます。
   - **リスク**：極めて不安定で、プラットフォームのアンチボット (Anti-bot) ブロック (HTTP 403 Forbidden) の影響を受けやすく、長期的なメンテナンスコストが非常に高いです。

---

## ゲームエンジン アーキテクチャロードマップ (Architecture Roadmap)

「運用コスト」「プレイヤー体験」「システム防御力」の最適なバランスを実現するため、Moyin ゲームエンジンの LLM 統合戦略は以下の 3 段階に分かれます：

### v0：ステートマシンとローリングサマリー (State Machine & Rolling Summary)

- **動作メカニズム**：ゲームエンジンが積極的にメモリ管理に介入します。構造化された状態設定 (`state.json`) を維持し、圧縮された「動的ローリングサマリー (`summary`)」と組み合わせ、直近 N=8 ラウンドの会話記録 (`recent_dialogue`) のみを保持して LLM に送信します。
- **アーキテクチャの利点**：入力トークンを定数レベルに精密制御し、プレイ時間に比例してコストが線形増加する問題を根絶します。
- **出力仕様**：LLM に厳格な JSON フォーマット (`narrative` ナレーション、`choices` 分岐、`state_delta` 状態変更を含む) での返答を強制します。

### v1：コントローラー・ライター パターンの分離 (Controller-Writer Pattern)

- **動作メカニズム**：デュアルモデル協調ルーティングを導入します。フロントに軽量な推論モデル (Controller) を配置し、バックエンドに深い感情理解能力を持つトップグレードモデル (Writer、例：Gemini Pro / Claude 3.5) を隠蔽します。
- **役割分担**：Controller はプレイヤーの入力意図の判定、必要に応じたローカル Lore チャンクの検索・動的注入、さらには無意味な対話のフィルタリングに専念します。最終的に、高コストな Writer モデルを起動してストーリーを執筆するかどうかを決定します。
- **アーキテクチャの利点**：ファネル型インターセプト (Funnel Interception) により、トップグレード推論モデルの呼び出し頻度と必要なコンテキストペイロードを大幅に削減します。

### v2：完全ローカルデプロイメント (Fully Localized Deployment)

- **動作メカニズム**：プレイヤーの端末に 7B～8B クラスのオープンソース中国語ナラティブ推論モデル (例：Llama-3-8B-Instruct, Qwen-2.5 等) を直接デプロイし、`llama.cpp` (GGUF Q4_K_M 量子化フォーマット) を介して高効率なローカル推論を実行します。
- **システム連携**：ゲームクライアントに軽量な Local LLM Server を内蔵し、OpenAI 仕様互換のシリアライズインターフェースを外部に提供することで、100% オフラインでのプレイを実現します。
- **アーキテクチャの利点**：
  - **ゼロ API コスト**：クラウドトークンサブスクリプション (Subscription) 課金から完全に脱却します。
  - **究極のプライバシー保護 (Privacy Protection)**：プレイヤーの会話データが外部に漏洩することは一切なく、コンプライアンスリスクを排除します。
  - **超低レイテンシ (Ultra-low Latency)**：プレイヤーのコンシューマーグレード GPU (例：RTX 30/40 シリーズ) を活用し、ミリ秒レベルのストリーミング生成体験を実現します。
- **実務上の制約と解決策**：ローカルモデルはハードウェアに制約されるため、コンテキストウィンドウはより保守的に設定する必要があります (N=6、サマリーは 200～500 トークンに制限)。エンジン側の `state_delta` JSON による厳密な状態遷移により大きく依存します。

---

## 商業化と運営戦略 (Commercialization Strategy)

### ステージ 1：MVP 最小実行可能プロダクト (Market Validation)

- 「シームレスハイジャック/インジェクション (Cookie Capture)」などの認証技術を導入し、プレイヤーが個人の無料 Web サービスをバインドできるようにします。これによりゲームのクラウドサーバー運用コストを大幅に削減し、迅速な市場テストとコミュニティトラフィックの拡大を実現します。

### ステージ 2：自己キー持ち込みモデル (BYOK - Bring Your Own Key)

- 「スタンドアロンランチャーとエンジンカーネルの販売」を核心ビジネスモデルに転換します。プレイヤーは設定ページで個人で申請したクラウド API キー (例：Gemini / Claude) をバインドする必要があります。
- **コアセリングポイント (USP)**：消費者が実質的に購入するのは、Moyin 開発チームが精錬した **プロンプトフレームワーク (Prompt Framework)**、**クローズドループメモリ管理アルゴリズム (Memory Management Algorithm)**、および**独占シナリオモジュール**であり、基盤となる言語能力そのものではありません。

### ステージ 3：コンプライアンスと免責事項 (Compliance & Disclaimer)

- ソフトウェアのエンドユーザーライセンス契約 (EULA) に以下を明記する必要があります：本サービスの中枢は外部クラウド推論に依存していますが、すべての会話履歴トークン配列はプレイヤーのローカルマシンにのみ保存され、バックグラウンドでのアップロードやサーバーバックアップは一切行いません。
- サーバー側で不可抗力による接続異常が発生した場合、開発者はクライアント側ブリッジの修復のみに責任を負い、サードパーティモデルプロバイダーの制限については免責とします。

---

_本ドキュメントは Moyin プロジェクトの商業・技術ブループリントに属し、チーム全体が LLM 統合の方向性と製品化の最終像について統一的な認識を持つことを目的としています。_
