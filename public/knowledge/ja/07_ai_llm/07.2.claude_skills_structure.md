# 07.2. Claude Code スキル拡張のディレクトリ構造規範 (Skills Directory Structure)

> **種類**: ツールのテクニックと AI 環境の構築  
> **日付**: 2026-01-11 (改訂: 2026-02-01)  
> **重点**: Claude Code および Antigravity における外部拡張パッケージ (Skills) の正しいフォルダ構造と YAML Frontmatter (メタ情報) の規定について詳細に説明し、`@` 修飾子に基づくトリガー機能が正常にマウントされることを保証します。

---

## 序および中心的な誤謬の是正

従来の理解では、開発者は、すべてのスキルやワークフローを単一の Markdown ファイルにまとめてしまうという間違いを犯しがちです (例：`.claude/skills/workflows.md` を作成し、`@workflows` を使用してグローバルスクリプトをトリガーすることを期待するなど)。このような **「単一ファイルへの集中化」** の設計は全く間違っています。

**正しいアーキテクチャの鉄則**:
独立した `@skill_name` のトリガーを確実にサポートするには、それぞれの独立した外部スキル (Skill) が **専用の物理的なディレクトリを持つ** 必要があります。

- **Antigravity (メインの開発プラットフォーム、標準となる SSOT)**: すべてのスキルパッケージは `.agent/skills/` 配下に構築してください。
- **Claude Code**: `.claude/skills/` 内に存在します (日常の開発において、`/sync-skills` ワークフローを実行することで、上記のメインリポジトリの内容をアクティブに同期して上書きすることができます)。

---

## 標準的なスキルのディレクトリ構造 (Standard Directory Layout)

以下に示す `handoff` や `new_issue` などのスキルの標準的なディレクトリ構成を参照してください：

```text
.agent/skills/          # (Antigravity のメインディレクトリ)
├── handoff/            # [各スキルの専用ディレクトリ]
│   ├── SKILL.md        # 必須：スキルのメインとなる説明ドキュメント
│   └── TEMPLATE.md     # 任意：補助用テンプレートやその他のコンテキストファイル
│
├── new_issue/          # @new_issue トリガーに対応
│   └── SKILL.md
│
├── inbox/              # @inbox トリガーに対応
│   └── SKILL.md
│
└── dev/                # @dev トリガーに対応
    └── SKILL.md
```

### なぜ階層型のディレクトリ設計を強制的に推進するのか？

1. **複数ファイルの連携をサポートするため**: 数多くの高度なスキル (仕事の引き継ぎ `handoff` など) は、主要スクリプト以外にも設定ファイルや出力テンプレートを付随させる必要があり、ディレクトリ構造にすることで初めてカプセル化の完全性を維持できるためです。
2. **ディレクトリレベルでの識別メカニズム**: Antigravity の基盤となるスキャンエンジンは、`.agent/skills/` ディレクトリ直下の **第1層目のサブディレクトリ** に直接アクセスし、ディレクトリ名を登録キーとみなし、その内部の `SKILL.md` を取得してキャッシュを構築します。

---

## SKILL.md 内部のドキュメント作成規範 (Document Specification)

各スキルの専用ディレクトリの下には、`SKILL.md` というメインファイルが必ず存在していなければなりません。さらに、このファイルの最上部には **絶対に YAML Frontmatter ブロックが含まれていなければなりません**。

```markdown
---
name: new_issue
description: "ユーザーが新たな ISSUE タスクトラッキングエンティティを作成するのを支援します。トリガー方法: @new_issue"
---

# 新規タスク Issue の作成 (new_issue)

## スキルの用途

このスキルは、AI エージェントが標準化された方法で `workspace/issues/` の下に追跡ファイルを生成するのを支援します...

## トリガーの方法とメカニズム

対話ボックスに次のように入力します：
`@new_issue`

## 期待されるワークフロー (Workflow)

...
```

### メタデータ (Frontmatter) の確認ポイント

- `name`: 外側のディレクトリ名と正確に一致している必要があります (これがトリガーコマンドとして登録されます)。
- `description`: 一つか二つの簡潔な文章で機能を要約する必要があります。**また、最後の段落には、必ずトリガー方法を明記してください** (例：「トリガー: @xxx」)。トリガーに関するヒントの文字列が欠けている場合、基盤となるエンジンは登録を破棄します。

---

## 移行とデバッグのガイド (Migration & Troubleshooting)

あなたのシステムに、まだ旧仕様の単一ファイルの構造が残っている場合は、以下のスクリプトロジックに従って移行を行ってください (ここでは一例として PowerShell を使用しています)：

### 誤った単一ファイル状態の一掃

```powershell
# 規格に準拠していない一枚岩のファイルを強制的に破棄する
Remove-Item ".claude/skills/workflows.md" -Force
```

### 規格に準拠したツリー階層の再構築

```powershell
# スキル名に基づいて物理ディレクトリを再設定する
New-Item -Type Directory ".claude/skills/new_issue" -Force
New-Item -Type Directory ".claude/skills/inbox" -Force

# (この後、上記で新規作成したディレクトリ内で個別の SKILL.md を記述してください)
```

### ❌ よくあるエラーの分析

- **エラー 1：深い階層にネストして埋もれている**
  - 【間違った書き方】 `.claude/skills/workflows/new_issue/SKILL.md`
  - 【解決策】 スキャンエンジンは再帰的に奥深くまでスキャンしません！ フラット化された単層のサブディレクトリ構造を厳格に順守してください： `.claude/skills/new_issue/SKILL.md`。
- **エラー 2：YAML ブロックの記載漏れ**
  - 【間違った書き方】 ファイルの冒頭から `---` の区切り線を無視して、いきなり `# new_issue` と書き始めている。
  - 【解決策】 `name` キーバリューのペアが欠けているファイルは、システムによって一般のドキュメントと判定され、マウントを拒否されます。直ちに YAML Frontmatter を補填してください。

---

## 関連リファレンスと拡張メンテナンス

- IDE を通じて、メインリポジトリ `.agent/skills/` 内のコードの修正が完了した後、外部のプレーンテキスト命令クライアント (Claude Code) 側でも同期して変更を反映させたい場合は、いつでも `/sync-skills` ワークフロースクリプトを呼び出してホットリロード (即時反映) を完了させてください。

---

## 💡 Vibecoding 指令

AI エージェントに新しいスキルを作成させたりディレクトリを管理させる際：

> 🗣️ `「Claude Code スキルを生成または変更する際、【標準ディレクトリ構造 (Standard Directory Layout)】を厳格に遵守してください。すべてのスキルロジックを単一の巨大な Markdown ファイルに放り込むことは絶対にやめてください！ 各スキルごとに '.agent/skills/' の下に専用のフォルダを作成し、その中に必ず 'SKILL.md' ファイルが存在するようにしてください。何よりも重要なのは、'SKILL.md' の最上部に必ず YAML Frontmatter を含め、'name' と 'description' キーを設定し、description 内に '@skill_name' トリガーを明記することです！」`
