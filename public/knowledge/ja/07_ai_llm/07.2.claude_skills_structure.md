# 07.2. Claude Code スキル拡張のディレクトリ構造規範 (Skills Directory Structure)

> **種類**: ツールのテクニックと AI 環境の構築
> **日付**: 2026-01-11 (改訂: 2026-02-01)
> **重点**: Claude Code および Antigravity における外部拡張パッケージ (Skills) の正しいフォルダ構造と YAML Frontmatter (メタ情報) の規定について詳細に説明し、`@` 修飾子に基づくトリガーメカニズムが正常にマウントされることを保証します。

---

## 前書きとコア謬論の修正

従来の理解では、開発者はすべてのスキルとワークフローを単一の Markdown ファイルに集約しがちです（例：`.claude/skills/workflows.md` を作成し、`@workflows` でグローバルスクリプトをトリガーすることを期待する）。この **「シングルファイル集中型」** 設計は完全に誤りです。

**正しいアーキテクチャの鉄則**：
独立した `@skill_name` トリガーを真にサポートするには、各独立外部スキル (Skill) が**専用の物理ディレクトリを持つ**必要があります。

- **Antigravity (メイン開発プラットフォーム、標準 SSOT)**: すべてのスキルパッケージは `.agent/skills/` 配下に構築してください。
- **Claude Code**: `.claude/skills/` に配置します（日常開発では `/sync-skills` ワークフローを実行して、上記メインリポジトリの内容を同期・上書きできます）。

---

## 標準ディレクトリレイアウト (Standard Directory Layout)

以下の `handoff` や `new_issue` などのスキルの標準ディレクトリ構造を参照してください：

```text
.agent/skills/          # (Antigravity メインディレクトリ)
├── handoff/            # [個別スキルの専用ディレクトリ]
│   ├── SKILL.md        # 必須：スキルのメインドキュメントファイル
│   └── TEMPLATE.md     # 任意：補助テンプレートやその他のコンテキストファイル
│
├── new_issue/          # @new_issue トリガーに対応
│   └── SKILL.md
│
├── inbox/              # @inbox トリガーに対応
│   └── SKILL.md
│
└── dev/                # @dev トリガーに対応
    └── SKILL.md
```

### なぜ階層型ディレクトリ設計を強制するのか？

1. **マルチファイル結合のサポート**：多くの高度なスキル（例：作業引き継ぎ `handoff`）はメインスクリプトに加え、設定ファイルや出力テンプレートを伴います。ディレクトリ構造でなければカプセル化 (Encapsulation) の完全性を維持できません。
2. **ディレクトリレベルの識別メカニズム**：Antigravity のコアスキャンエンジンは `.agent/skills/` ディレクトリ直下の**第一階層サブディレクトリ**を直接走査し、ディレクトリ名をレジストリキーとして扱い、内部の `SKILL.md` をキャプチャしてキャッシュを確立します。

---

## SKILL.md 内部ドキュメント仕様 (Document Specification)

各スキル専用ディレクトリ内には、`SKILL.md` という名前のメインファイルが必ず存在しなければなりません。さらに、このファイルの先頭には**必ず YAML Frontmatter ブロック**を含めてください。

```markdown
---
name: new_issue
description: "ユーザーが新しい ISSUE タスクトラッキングエンティティを作成するのを支援します。トリガー：@new_issue"
---

# 新しいタスク Issue の作成 (new_issue)

## スキルの用途

本スキルは AI エージェントが `workspace/issues/` 配下にトラッキングファイルを標準化して生成するのを支援します...

## トリガー方法とメカニズム

ダイアログボックスで入力：
`@new_issue`

## 想定ワークフロー (Workflow)

...
```

### Frontmatter 検証チェックポイント

- `name`: 外側のディレクトリ名と正確に一致する必要があります（これがトリガーコマンドとして登録されます）。
- `description`: 1〜2 文で機能を簡潔に要約し、**末尾にはトリガー方法を明記する**必要があります（例：「トリガー：@xxx」）。トリガーヒント文字がない場合、コアエンジンは登録を破棄します。

---

## マイグレーションとトラブルシューティングガイド (Migration & Troubleshooting)

システムにレガシーなシングルファイル構造がまだ残っている場合は、以下のスクリプトロジックに従って移行してください（ここでは PowerShell を例にします）：

### 誤ったシングルファイル状態のクリーンアップ

```powershell
# 非準拠のモノリシックファイルを強制削除
Remove-Item ".claude/skills/workflows.md" -Force
```

### 準拠ツリー階層の再構築

```powershell
# スキル名に基づいて物理ディレクトリを再配備
New-Item -Type Directory ".claude/skills/new_issue" -Force
New-Item -Type Directory ".claude/skills/inbox" -Force

# (上記で新しく作成したディレクトリ内に個別の SKILL.md を記述してください)
```

### よくあるエラー分析

- **エラー 1：多階層ネスト**
  - 【誤った実装】 `.claude/skills/workflows/new_issue/SKILL.md`
  - 【解決策】 スキャンエンジンは再帰的に深く探索しません！フラットな単一階層サブディレクトリ構造を厳守してください：`.claude/skills/new_issue/SKILL.md`。
- **エラー 2：YAML ブロックの欠落**
  - 【誤った実装】 ファイルの冒頭にいきなり `# new_issue` と書き、`---` 区切りを無視する。
  - 【解決策】 `name` キーバリューペアが欠如したファイルはシステムにより通常のドキュメントと判定され、マウントが拒否されます。直ちに YAML Frontmatter を補完してください。

---

## 関連リファレンスと拡張メンテナンス

- IDE を通じてメインリポジトリ `.agent/skills/` 内のコード修正が完了した際、外部のプレーンテキスト指示端 (Claude Code) にも同期的に反映させる必要がある場合は、いつでも `/sync-skills` ワークフロースクリプトを呼び出してホットリロード (Hot Reload) を完了してください。
