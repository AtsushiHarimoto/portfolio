# 28. 機械に立ち止まって考えさせる：思考の連鎖 (CoT) と Agentic ワークフロー革命

> **種類**: 大規模言語モデルの応用実践とアーキテクチャ設計パターン
> **重点**: 実戦の真髄に呼応します。AI はボタンを押せば標準回答が出てくる自動販売機ではありません。本章では、今年シリコンバレーで最も推奨される 2 大パラダイムを公開します：脳を System 2（遅い思考）に強制的に切り替える **思考の連鎖 (Chain of Thought, CoT)**、そして AI 自身がボスとなり、繰り返し仕事を修正する **Agentic Workflows（知能エージェントワークフロー）** です。

---

## 前言：速い思考 (System 1) の愚かな失敗

心理学の巨匠カーネマンは、人間の思考には 2 種類あると述べました：System 1（直感的反射）と System 2（遅速の深い思考）。
従来の GPT-3 や ChatGPT はすべて標準的な System 1 オペレーターです。
複雑な質問をすると：「リンゴが 1 個あります。半分食べて、種を 2 つ吐き出しました。果物は何個残っていますか？」
「半分食べた、2 つ吐き出した」という単語列の確率が高すぎるため、0.1 秒後に荒唐無稽な数字を即座に当てずっぽうで出します。自己回帰 (Auto-regressive) モデルは「後戻りできない」ため ── テキストは覆水盆に返らずのように前に進み続けるだけで ── 頭の中で下書きする時間がないのです！

---

## 1. 魔法の呪文の奇跡：思考の連鎖 (Chain of Thought, CoT)

2022 年、研究者たちは計り知れない価値を持つ魔法のプロンプト (Prompt) を発見しました：**「Let's think step by step（一歩一歩考えましょう）。」**

この一文を追加しただけで、GPT は突然オリンピック数学の天才に変貌しました。なぜでしょうか？

- **出力を使って「メモリと下書きの時間」を買う。**
- モデルにステップバイステップを求めると、最終回答の前にプロセステキストの出力を強制されます。例：_「1. リンゴは 1 つの果物です。2. 半分食べたということは実体の半分が残っています。3. 種は果肉ではありません...」_
- このテキストは **KV Cache** にプッシュされ、その後の推論を続けるための階段になります！これは事実上、ニューラルネットワークの System 1 の直感を一時停止させ、厳密な **System 2（論理的演繹）** に移行させることに等しいです。

現代の OpenAI o1 モデルでは、このプロセスは隠蔽・自動化されています（内蔵の熟考時間 Time-to-think）。これはモデルの論理推論能力を劇的に向上させる最も安価で最も強力な手段です。

---

## 2. 伝統を覆す四柱の神：Agentic Workflows（知能エージェントワークフロー）

5 万字の小説を書きたい場合、GPT に「小説を書いてください」と言うと、出てくるものは絶対に読むに堪えないゴミです。
AI の大家アンドリュー・ン (Andrew Ng) はこのため **Agentic Workflows** パラダイムを強力に推進しました。AI をテキストを吐き出すプリンターとして扱うのではなく、「自己反省できるプロジェクトチーム」として扱うのです。

Agentic の境地に達するには、4 つの設計パターンを駆使する必要があります：

### 1. リフレクションと自己修正 (Reflection)

ループを作成します：まず AI に第 1 章を書かせます。次に**完全に別の AI（レビュアー）** を起動し、命令します：「先ほどの文章から不自然な表現を 10 箇所見つけてください。」
その 10 箇所を元の AI に投げて書き直しを要求します。この左手が右手を叩くサイクルを 3 回繰り返すと、最終的な文章は 99% の人間のライターを超えるクオリティに達します。

### 2. ツール使用 (Tool Use)

第 23 篇の Generative UI の原理で触れた通りです。AI は数学が苦手で、`3894 * 123` を計算できません。
そこで道具を渡します：「算術に遭遇したら、自分で推測せずに `python_calculator()` という関数を呼び出してください」と AI に伝えます。AI は自身の盲点を補うために外部ツールを使うことを学びました。今では自らウェブ検索 (Web Search) したり、ローカルデータベースを検索 (RAG) したりすることもできます。

### 3. プランニング (Planning)

「日本への 7 日間の個人旅行を計画してください」という壮大な目標に直面して、
エージェントはまず下書きを作り、自らをいくつかのタスクに分割します：
`[ステップ 1: オンラインで観光スポットを検索] -> [ステップ 2: API を呼び出して航空券を確認] -> [ステップ 3: 費用を合計]`。
途中で航空券が高すぎることがわかれば、人間のように**前のステップに戻って再計画**できます。

### 4. マルチエージェント協調 (Multi-Agent Collaboration)

これは将来の Moyin の究極の形態です！
1 つの AI に「リードプログラマー」、別の AI に「セキュリティ監査人」、さらに別の AI に「QA テスター」を演じさせます。エンジニア AI がコードを書き、テスター AI が自動的にユニットテストを実行します。赤いエラーテキストが表示されれば、テスター AI がエラーログをエンジニア AI の顔に叩きつけて修正を要求します。
3 体のロボットが一晩中激しく議論し、翌朝起きると、完璧なテストカバレッジを持つ神級のソフトウェアがすでに完成しています。これが Microsoft の **AutoGen** などのフレームワークが現在世界中を席巻しているシナリオです。

---

## Vibecoding 高度なシステム設計のコツ

Claude の指示や Moyin 内部の高度に複雑な大規模モデル運用スクリプトの構築時：

> `「Moyin のドキュメント分析用バックエンドモジュールを構築する際、一発撮りの LLM API 呼び出し (Zero-shot) の使用を厳禁します！このレベルの高度な要件には、アンドリュー・ンが推奨する【Agentic Workflows（知能エージェントワークフロー）】を導入してください。パイプラインを設計してください：第 1 層のモデルは【Chain of Thought (CoT)】を使用して推論プロセスの出力を強制する必要があります。第 2 層には【Reflection（自己反省）】のレビュアーエージェントを配置し、文章が 00_core_protocol 規範に準拠していることを確認してください。そして情報が不足していることを検知した場合、ブレインが自律的に【Tool Use（ツール呼び出し）】を発動してローカルの grep_search 検索をトリガーするよう設定してください！」`
