# 03.5. PowerShell Tips & Troubleshooting Playbook

> **Type**: Terminal development craft  
> **Focus**: Capture the permission and path obstacles that surface when Windows PowerShell drives the Moyin project and provide reusable alias scripts for rapid recovery.

---

## Overview
PowerShell brings a rich object model to the Microsoft ecosystem, yet executing Node.js, Git, and other open-source toolchains often trips over its execution policy and file locking behavior. This playbook collects the handful of commands and shortcuts that keep local development from stalling when the shell insists on pointing at execution policies or MAX_PATH limits.

---

## 1. Force clearing the `node_modules` sinkhole
When a frontend dependency tree collapses on Windows, conventional PowerShell struggles to mimic Linux-style `rm -rf`. Node modules carve deeply nested paths and trigger readonly locks, so `Remove-Item` usually errors out before the directory disappears.

### ðŸŒŸ Industry-standard fix: delegate to `rimraf`
`rimraf` is the npm community tool crafted for cross-platform cleanups, especially the Windows path nightmares. No global install is required; invoke it with `npx` from the project root and it will delete without failing on long filenames:

```powershell
# Run from the frontend root; this command will not choke on long paths
npx rimraf .\node_modules\
```

### Fallback: native PowerShell flags
If you prefer to stay inside the shell, the aggressive flags below release read-only locks and recurse through every folder:

```powershell
# -Recurse walks every child item, -Force removes filesystem locks
Remove-Item -Recurse -Force .\node_modules\
```

---

## 2. Create project-specific shortcuts (Profile Aliases)
Typing full repository paths is a productivity killer. Bind your most frequent navigation and cleanup commands to `$PROFILE` so the aliases load with every shell session.

1. Open the profile file (PowerShell will prompt to create it if it is missing):

```powershell
notepad $PROFILE
```

2. Append this snippet, save, and restart PowerShell:

```powershell
# Moyin project shortcuts
$MOYIN_ROOT = "D:\AI-Novel-Projects\Moyin"

function mo-api { Set-Location "$MOYIN_ROOT\projects\api" }
function mo-web { Set-Location "$MOYIN_ROOT\projects\moyin-web" }
function mo-game { Set-Location "$MOYIN_ROOT\projects\moyin-game-v1\website" }

function rmf {
    param([Parameter(Mandatory=$true)]$Path)
    Remove-Item -Recurse -Force $Path
}
```

After restarting, `mo-api` jumps straight into the backend workspace and `rmf` emulates a Linux-style cleanup with an explicit path parameter.

---

## 3. Cross-platform Node runtime pitfalls
Moyin maintains dual Node channelsâ€”Node 18 for macOS/Linux and Node 22 for Windows. Treat the following guards as gospel to keep everyone aligned:

- **Lock file discipline (`pnpm-lock.yaml`)**: Never delete it when a Windows checkout complains about a mismatch. The lock keeps dependency trees identical on both platforms.
- **Engine constraints (`package.json` `engines`)**: Every package declares `"node": ">=18.0.0"` so installers fail fast when a developer drifts outside the supported range.
- **Binary rebuilds**: When native modules such as `node-sass` or `esbuild` throw C++ incompatibility errors, recreate the tree and reinstall:

```powershell
npx rimraf .\node_modules\
pnpm install
```

---

## 4. System-level permission hurdles
Encountering the red error `running scripts is disabled on this system` indicates PowerShell is blocking your script for security reasons. Run the following command in an administrator shell to allow locally authored scripts while still requiring signatures for remote downloads:

```powershell
# Allow locally authored scripts while retaining signature requirements for downloaded code
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

Confirm the prompt with `Y`, then the shell safely runs your bootstrapping scripts, alias definitions, and pnpm hooks.
