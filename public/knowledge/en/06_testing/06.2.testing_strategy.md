# 06.2 Testing Strategy

> **Type**: Development Standards
> **Date**: 2026-02-26
> **Status**: Outline
> **Related**: `06.1.automation_basics.md`

---

## Abstract

Defines the multi-tiered testing strategy for the Moyin project, covering the division of labor, tool selection, and execution standards for Unit Testing, Integration Testing, and E2E Testing.

---

## 1. The Testing Pyramid

```
        /  E2E  \           Small volume, verifies critical user flows
       /---------\
      /Integration\         Medium volume, verifies collaboration between modules
     /-------------\
    /  Unit Tests   \       Large volume, verifies single functions/components
   /-----------------\
```

| Tier        | Volume Ratio | Speed          | Maintenance Cost | Confidence Level     |
| ----------- | ------------ | -------------- | ---------------- | -------------------- |
| Unit        | ~70%         | Extremely Fast | Low              | Single Module        |
| Integration | ~20%         | Medium         | Medium           | Module Collaboration |
| E2E         | ~10%         | Slow           | High             | End-to-End Workflow  |

---

## 2. Technology Stack Selection

### 2.1 Frontend (Vue 3 + TypeScript)

| Tier      | Tool                          | Purpose                                   |
| --------- | ----------------------------- | ----------------------------------------- |
| Unit      | **Vitest**                    | Component Logic, Composables, Pinia Store |
| Component | **Vue Test Utils** + Vitest   | Component Rendering, Event Interaction    |
| E2E       | **Playwright** or **Cypress** | Browser End-to-End Workflow               |

### 2.2 Backend (Python / Node.js)

| Tier        | Tool                    | Purpose                           |
| ----------- | ----------------------- | --------------------------------- |
| Unit        | **pytest** / **Vitest** | Business Logic, Utility Functions |
| Integration | **pytest** + **httpx**  | API Endpoints, DB Operations      |
| E2E         | **Playwright**          | Full Link Verification            |

### 2.3 MCP Server

| Tier        | Tool            | Purpose                     |
| ----------- | --------------- | --------------------------- |
| Unit        | Vitest / pytest | Tool Handler Logic          |
| Integration | MCP Inspector   | Protocol Level Verification |

---

## 3. Testing Standards

### 3.1 File Naming and Location

```
projects/<project>/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ       ‚îî‚îÄ‚îÄ MyComponent.vue
‚îú‚îÄ‚îÄ tests/                    # or test/
‚îÇ   ‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MyComponent.test.ts
‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ e2e/
‚îÇ       ‚îî‚îÄ‚îÄ login-flow.spec.ts
```

> ‚ö†Ô∏è Iron Rule: Testing files must only reside within the `test/` or `tests/` directory of their corresponding project. Cross-project testing is strictly prohibited.

### 3.2 Naming Conventions

```typescript
// Unit Test
describe('MyComponent', () => {
  it('should render title when prop is provided', () => { ... })
  it('should emit click event when button is pressed', () => { ... })
})

// Format: should [expected behavior] when [trigger condition]
```

### 3.3 Test Classification Tags

| Tag           | Meaning             | CI Behavior                        |
| ------------- | ------------------- | ---------------------------------- |
| `@smoke`      | Smoke Test          | Must run on every commit           |
| `@regression` | Regression Test     | Must run before PR merge           |
| `@slow`       | Time-Consuming Test | Triggered on a schedule / Manually |

---

## 4. Key Points for Each Testing Tier

### 4.1 Unit Test

| Point           | Description                                         |
| --------------- | --------------------------------------------------- |
| Isolation       | Mock external dependencies (APIs, DB, File Systems) |
| Coverage Target | Core business logic ‚â• 80%                           |
| Speed           | Single test < 100ms                                 |
| Focus           | One test case verifies exactly one behavior         |

### 4.2 Integration Test

| Point             | Description                                             |
| ----------------- | ------------------------------------------------------- |
| Scope             | Collaboration of 2‚Äì3 modules                            |
| Real Dependencies | Use real DB (test DB) and real APIs as much as possible |
| Setup/Teardown    | Clean up state before and after every test              |

### 4.3 E2E Test

| Point            | Description                                              |
| ---------------- | -------------------------------------------------------- |
| User Perspective | Simulate real user operation flows                       |
| Critical Path    | Only cover core business flows (Login, Create, Publish)  |
| Stability        | Avoid flaky tests ‚Üí Use `data-testid` to locate elements |
| Timeout          | Set reasonably to avoid false failures                   |

---

## 5. CI/CD Integration

### 5.1 Execution Timing

```
git push ‚Üí Unit + Integration (< 5 min)
PR open  ‚Üí Unit + Integration + E2E Smoke (< 15 min)
PR merge ‚Üí Full Regression (< 30 min)
Nightly  ‚Üí Full Suite + Performance (No time limit)
```

### 5.2 Quality Thresholds

| Metric            | Threshold                             |
| ----------------- | ------------------------------------- |
| Unit Coverage     | ‚â• 80% (Core Modules)                  |
| Test Pass Rate    | 100% (Known failures are not allowed) |
| E2E Critical Path | All passing                           |

---

## 6. Testing Toolbox

| Tool                          | Purpose                      |
| ----------------------------- | ---------------------------- |
| **Vitest**                    | Unit/Integration Test Runner |
| **Vue Test Utils**            | Vue Component Testing Aide   |
| **MSW** (Mock Service Worker) | API Mocking                  |
| **Playwright**                | E2E / Browser Automation     |
| **Faker.js**                  | Test Data Generation         |
| **c8 / istanbul**             | Coverage Reporting           |

---

## Pending Deep Dives

- [ ] Specific Vitest Configuration Examples
- [ ] Playwright E2E Test Script Examples
- [ ] Visual Regression Testing (Screenshot Comparison)
- [ ] API Contract Testing (Frontend-Backend Contracts)
- [ ] Test Data Management Strategy (Factory / Fixture)

---

## üí° Vibecoding Instructions

When asking the AI agent to write testing infrastructure or test cases:

> üó£Ô∏è `"When generating test files, strictly follow the [Testing Pyramid] and [Test Classification Tags] outlined in the testing strategy. Ensure unit tests are strongly isolated and achieve an 80% coverage rate on core logic, using [Vitest] and [Vue Test Utils] for front-end components. Make sure to place the test file in the correct 'tests/unit' directory and use the 'should [expected behavior] when [trigger condition]' naming convention!"`
