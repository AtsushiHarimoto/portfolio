# Multi-AI Agent Collaboration Framework Design

> **Type**: Technical Decision + Best Practices
> **Date**: 2026-01-07
> **Source**: Session - Multi-Agent Collaboration System Setup

---

## Summary

Establishes a three-party collaboration framework among Claude (solution design), Codex (code audit), and Antigravity (execution engineer). This document defines the collaboration flows, role responsibilities, and the underlying technical architecture (Skills library and sync mechanisms) that supports the system.

---

## Background

In traditional AI-assisted development, a single AI handles everything -- from requirements analysis and code writing to testing. This single-point operation easily leads to:

- **Direction Drift**: Writing code without architecture confirmation, causing frequent rework.
- **Inconsistent Quality**: No independent audit step, leading to uneven adherence to engineering standards.
- **Poor Traceability**: Lack of structured documentation for decision processes, creating knowledge gaps.

This framework eliminates these issues through a clearly defined three-party collaboration mechanism.

---

## Detailed Design

### Role Definitions (2026-01 Update)

#### Claude - Architect / Planning Coordinator

- **Responsibilities**: Requirements analysis, system architecture design, complex large-scale task planning, Code Review auditing.
- **Strengths**: Decomposes high-level business requirements into highly actionable technical blueprints; rigorously gatekeeps source code quality.
- **Outputs**: Structured proposal documents (including objectives, impact boundaries, implementation guidelines, test and acceptance criteria), Review reports.
- **Applicable Scenarios**: New feature architecture design, refactoring strategy formulation, core technology selection, cross-module coordination and pre-development planning.

#### Codex - Backend / Data Engineer

- **Responsibilities**: Backend business logic development, data transformation, API endpoint implementation and maintenance, database operations.
- **Strengths**: Precisely handles backend and data-layer tasks, ensuring logic closure and data structure consistency.
- **Outputs**: Backend source code changes + API implementation scripts + data access computation logic.
- **Applicable Scenarios**: API development and integration, data migration and cleansing, backend bug fixes, system performance tuning.

#### Antigravity - Operations Manager / Frontend UI Engineer

- **Responsibilities**: Daily task management, UI visual and functional implementation, frontend engineering development, rapid prototype iteration.
- **Strengths**: Rapid execution of clearly defined task tickets, translating UI/UX design intent into reality, handling system daily maintenance.
- **Outputs**: Frontend source code changes + encapsulated UI components + test success evidence logs + task closure reports.
- **Applicable Scenarios**: UI interface development, frontend bug resolution, routine maintenance, rapid prototyping.

### Collaboration Flows

#### Mode 1: Requirements-Driven (Claude -> Antigravity)

```
User requirement input
  |
Claude produces a technical blueprint -> Archived to workspace/plans/PLAN_*.md
  |
Antigravity reads blueprint -> Confirms Scope -> Executes coding -> Reports status -> Commits to version control
```

**Use Cases**: New module features, code architecture refactoring, cutting-edge technology exploration.

#### Mode 2: Audit-Driven (Codex -> Antigravity)

```
Code quality alert or technical debt trigger
  |
Codex conducts global audit -> Generates fix proposals and patch recommendations -> Archived to workspace/plans/PLAN_CODEX_*.md
  |
Antigravity reads fix tickets -> Executes non-compliant code repairs -> Runs local verification tests -> Reports status -> Commits
```

**Use Cases**: Coding standard enforcement, comprehensive tech debt cleanup, system security vulnerability audits.

#### Mode 3: Hybrid High-Assurance Collaboration

```
Claude produces initial design -> Antigravity implements -> Codex conducts post-implementation quality audit ->
(If issues found) Codex proposes fix tickets -> Antigravity executes secondary fixes -> Tests pass, case closed
```

**Use Cases**: Critical core feature launches, large projects with high security or quality assurance requirements.

### Standardized Plan Format

All design or fix proposals from Claude or Codex must follow this mandatory 4-section structure:

```markdown
# [Task Title]

## 1. Core Objective

One concise sentence stating the purpose and expected outcome.

## 2. Impact Scope

- Files to modify: [full absolute path list]
- Files to create: [full absolute path list]

## 3. Implementation Details

Key technical breakthroughs + prototype code examples (Claude perspective)
or
Specific violations + before/after code comparisons (Codex perspective)

## 4. Acceptance Criteria

- [ ] Verifiable completion checklist items
```

---

## Technical Architecture and Skills System

The underlying implementation of this collaboration framework is guided by two core principles: **SSOT (Single Source of Truth)** and **Smart Context Loading**.

### 1. Skill Library Design

All AI core capabilities are declared once in `.agent/skills/` as the global single source of truth.

- **Physical Directory Structure**:
  ```text
  .agent/skills/
  ├── feature-dev/        # Standard development collaboration flow (Doc-Plan-Act cycle)
  ├── bg-standard/        # Bug investigation flow
  ├── sync-skills/        # Automated skill sync scripts
  └── ...
  ```
- **`.claude/skills/`**: Architect-specific synced copy (Sync Target).
- **`.codex/skills/`**: Auditor/Backend-specific synced copy (Sync Target).

### 2. Sync Mechanism

The `sync-skills` automation script ensures all three Agents share symmetric capability definitions and constraints.

- **Flow Path**: Source base `.agent/skills` -> Distributed via `Copy` tool -> `.codex/skills` and `.claude/skills`
- **Goal**: Single-point update, multi-point enforcement. When the team updates underlying standards (e.g., Git Commit format), all AI agents automatically refresh their internal knowledge and operational rules.

### 3. Smart Context Loading

To optimize token consumption, the system detects the current **SCOPE** context based on `AGENTS.md` task boundaries and dynamically mounts the appropriate context:

| Target SCOPE    | Auto-Loaded Rule Matrix       | Strategy Purpose                                                            |
| :-------------- | :---------------------------- | :-------------------------------------------------------------------------- |
| **API Project** | Core + TS Rules               | Focus on business logic and type safety, strictly blocking UI/CSS noise     |
| **Frontend**    | Core + TS + Vue + Style Rules | Ensure visual token consistency and frontend component design standards     |
| **QA Project**  | Core + Testing Rules          | Focus on test case boundary conditions and quality verification standards   |

### 4. Agent Role Matrix Overview (2026-01 Configuration Update)

| Agent Code      | Internal Role     | Responsibilities                                          | Deliverables                            | Applicable Task Scenarios                              |
| :-------------- | :---------------- | :-------------------------------------------------------- | :-------------------------------------- | :----------------------------------------------------- |
| **Claude**      | **Architect**     | High-level architecture, complex task coordination, Review | Architecture docs, quality Review reports | New module design, project refactoring, tech selection |
| **Codex**       | **Backend**       | Backend logic, data migration, API development            | Backend code, API implementations        | API endpoints, data processing, backend bug fixes      |
| **Antigravity** | **Frontend**      | Daily management, UI implementation, frontend execution   | Frontend code, encapsulated UI components | GUI development, maintenance, rapid prototyping        |

---

## Code and Tool Examples

### Skills Script Configuration

**Claude-Specific Skill** (`.claude/skills/handoff/SKILL.md`):

```markdown
---
name: handoff
description: "Claude produces architecture blueprints; Antigravity receives work orders and executes downstream code implementation."
---

# Handoff - Claude -> Antigravity Cross-Agent Collaboration

...
```

**Codex-Specific Skill** (`.codex/skills/handoff/SKILL.md`):

```markdown
---
name: handoff
description: "Codex performs global audits and produces defect fix proposals for Antigravity to implement."
---

# Handoff - Codex -> Antigravity Cross-Agent Collaboration

...
```

### Automated Workflow Construction

**Antigravity Execution Workflow** (`.agent/workflows/claude_task.md`):

```markdown
---
description: Receives architecture proposals from Claude or Codex handoffs and executes zero-deviation implementation tasks accordingly.
---

# Workflow: Claude Task Handoff

## 1. Read Plan

## 2. Confirm Scope

## 3. Implementation

## 4. Report Status
```

---

## Scenario Selection Guide (2026-01 Update)

### When to Call Claude?

- When designing a new feature from scratch or analyzing complex architecture
- When evaluating cross-language or cross-system technology selection
- When the system faces structural aging and needs a global refactoring strategy
- When critical modules need thorough Code Review before production deployment
- When decomposing and planning large-scale epic tasks spanning multiple modules

### When to Call Codex?

- When building backend service API routes and endpoint logic
- When writing asynchronous data cleansing and processing logic
- When authoring SQL CRUD operations or data migration scripts
- When debugging data races or deadlocks in backend services
- When optimizing backend system performance to reduce latency and increase throughput

### When to Call Antigravity?

- When building refined UI/UX functionality from design mockups
- When fixing broken DOM structures or CSS frontend bugs
- When managing and progressing routine daily development tasks
- When rapidly building an MVP prototype for validation
- When decomposing and encapsulating highly reusable Vue frontend components

---

## Related Knowledge Base References

- [Multi-Agent Collaboration Overview](../../workspace/MULTI_AGENTS_COLLABORATION.md)
- [Claude Handoff Skill](../../.claude/skills/handoff/SKILL.md)
- [Codex Handoff Skill](../../.codex/skills/handoff/SKILL.md)
- [Antigravity Task Workflow](../../.agent/workflows/claude_task.md)

---

## Core Safeguards and Precautions

- **Mandatory Structured Proposals**: Before submission, verify that documents contain Objective, Scope, Implementation Details, and Acceptance Criteria sections.
- **Clear Path References**: Relative ambiguous paths are forbidden; all paths must reference from the project root as absolute path strings.
- **Measurable Acceptance Criteria**: Eliminate vague descriptions like "improve performance"; replace with objective, measurable test points like "API returns 200 OK within 200ms after clicking the login button."
- **Unified Task Channel**: For Antigravity, regardless of whether the upstream directive comes from Claude or Codex, all tasks are received through the unified `/claude_task` channel.

---

## Benefits Summary

| Benefit Area              | Value                                                                                      |
| ------------------------- | ------------------------------------------------------------------------------------------ |
| **Role Separation**       | Each agent in its lane; eliminates the chaos of a single omnipotent AI diverging wildly.    |
| **Direction Convergence** | Document-based proposals serve as buffer gates; coding proceeds only after user approval.   |
| **Knowledge Replay**      | All proposal histories are preserved as `.md` artifacts, immediately available for review.  |
| **Template Reuse**        | Highly abstracted planning documents can be archived and reused for similar future tasks.   |
| **Automated Quality Gate**| Codex acts as the final code audit officer, ensuring codebase purity and compliance.        |

---

_This document was auto-generated by the modular maintenance system_
