# Workflow File Format Standard

> **Type**: Best Practices
> **Date**: 2026-01-03
> **Source**: Conversation ID (2026-01-03 Session)

---

## Summary

Defines the standard format for `.agent/workflows/` workflow files, including YAML frontmatter, step numbering, turbo markers, error handling tables, and usage examples. Ensures workflows are executable and easy to maintain.

---

## Background

Workflow files need standardized formatting to ensure:

1. **AI can recognize and execute them**
2. **Steps are clear and trackable**
3. **Error handling is comprehensive**
4. **Users can easily understand them**

---

## Detailed Design

### Core Format Requirements

#### 1. YAML Frontmatter (Required)

Every workflow file must begin with YAML frontmatter:

```yaml
---
description: { brief workflow description }
---
```

**Example**:

```yaml
---
description: Development SOP
---
```

#### 2. Title and Purpose (Required)

```markdown
# {Workflow Name}

## Purpose

{Detailed description of the workflow's purpose, 1-3 paragraphs}
```

#### 3. SCOPE Path Mapping (If Multi-Project)

```markdown
## SCOPE Path Mapping

Select the corresponding work paths based on the current SCOPE:

| Sub-project | Code Root                    | Doc Root                 | Review Output                   |
| ----------- | ---------------------------- | ------------------------ | ------------------------------- |
| **API**     | `projects/moyin-gateway/web2api` | `projects/moyin-gateway/docs` | `projects/moyin-gateway/docs/review` |

...
```

#### 4. Execution Steps (Required)

Use `### Step N:` format:

```markdown
## Execution Steps

### Step 0: Confirm Current SCOPE

// turbo
{Step description}

**Prerequisites**: {if any}

**Checklist**:

- Check item 1
- Check item 2

**If issues found**:

- Use `ASK:` to ask the user

**Output**: {step output}

---

### Step 1: {Step Name}

{Step description}

**Output**: {step output}
```

#### 5. Turbo Marker (Optional)

If a step can execute automatically, add the `// turbo` marker:

```markdown
### Step 1: Scan Files

// turbo
Execute `git status` to get the changed files list.
```

#### 6. Stop Conditions (Required)

```markdown
## Stop Conditions

The workflow ends when any of the following conditions are met:

1. {Condition 1}
2. {Condition 2}
3. {Condition 3}
```

#### 7. Error Handling Table (Required)

```markdown
## Error Handling

| Error Scenario | Resolution       |
| -------------- | ---------------- |
| {Error 1}      | {Resolution 1}   |
| {Error 2}      | {Resolution 2}   |
```

#### 8. Usage Examples (Recommended)

```markdown
## Usage Examples

### Example 1: {Scenario Description}

**User Input**:
```

/workflow-name

```

**AI Execution**:
1. {Step 1}
2. {Step 2}
3. {Step 3}
```

#### 9. Precautions (Recommended)

```markdown
## Precautions

1. **{Precaution 1}**: {Details}
2. **{Precaution 2}**: {Details}
```

---

## Code/Command Examples

### Example 1: Complete Workflow File Structure

```markdown
---
description: Brief workflow description
---

# Workflow Name

## Purpose

{Purpose description}

---

## SCOPE Path Mapping

{If multi-project}

---

## Execution Steps

### Step 0: Confirm SCOPE

// turbo
{Step description}

---

### Step 1: {Step Name}

{Step description}

---

## Stop Conditions

{Stop condition list}

---

## Error Handling

{Error handling table}

---

## Usage Examples

{Usage examples}

---

## Precautions

{Precaution list}
```

### Example 2: Turbo Marker Usage

```markdown
### Step 1: Scan Directory

// turbo
Scan all category directories under `workspace/knowledge/`.

**Output**: File list (grouped by category).

---

### Step 2: Confirm Archiving Strategy

**Prerequisites**: Directory scan complete.

**ASK User**:

- List all knowledge items with suggested categories
- Ask: "Is the above categorization correct?"

**Output**: Confirmed knowledge item categories.
```

### Example 3: Error Handling Table

```markdown
## Error Handling

| Error Scenario          | Resolution                             |
| ----------------------- | -------------------------------------- |
| SCOPE not specified     | ASK user to confirm sub-project        |
| Doc-code contradiction  | Output review report and ASK for fix strategy |
| Code Review failed      | Output issues and await fix            |
| Cross-SCOPE changes     | Reject and prompt for separate commits |
```

---

## Use Cases

- **Scenario 1: Creating a new workflow**
  Use this standard to create properly structured workflow files.

- **Scenario 2: Refactoring existing workflows**
  Convert simple bullet points to detailed steps + turbo markers + error handling.

- **Scenario 3: Workflow review**
  Check whether existing workflows comply with this standard.

- **Scenario 4: Document template**
  Use this standard as a workflow file template.

---

## Related Resources

- [run-dev.md](../../../.agent/workflows/run-dev.md) - Development workflow example
- [run-qa.md](../../../.agent/workflows/run-qa.md) - Testing workflow example
- [run-archive.md](../../../.agent/workflows/run-archive.md) - Archive workflow example
- [deliverables_jap.md](../../../.agent/workflows/deliverables_jap.md) - Japanese deliverables sync example

---

## Precautions

- **YAML frontmatter must be at the very top of the file**
  No blank lines or comments before the `---` delimiter.

- **Step numbering starts from Step 0**
  Step 0 is typically used for SCOPE confirmation or prerequisite checks.

- **Turbo marker applies to individual steps only**
  If the entire workflow can auto-execute, use `// turbo-all`.

- **Error handling table must cover common errors**
  Include at least 4-6 error scenarios.

- **Usage examples must be executable**
  Provide real commands and expected output.

---

_This document was auto-generated by `/run-wiki conversation`_
