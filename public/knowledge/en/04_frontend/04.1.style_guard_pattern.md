# 04.1. 樣式規格閘門設計模式 (Style Guard Pattern)

> **類型**: 最佳實踐與防錯機制  
> **日期**: 2026-01-03  
> **來源**: 對話紀錄 (2026-01-03)

---

## 摘要

為防止 AI 在撰寫 UI 組件時，發生「創造性填充 (Creative Hallucination)」導致樣式偏離設計規範並引發反覆修改，本專案導入「樣式規格閘門 (Style Guard)」機制。
透過強制查閱 Design Tokens、實施 SCOPE 目錄映射表與標準化的提問 (ASK) 關卡，嚴格確保所有 CSS 樣式變動皆與現行主題設計系統保持 100% 同步。

---

## 1. 背景與痛點分析

在由大語言模型 (LLM) 輔助進行 UI 開發的過程中，極易衍生下列亂象：

1. **創意暴走 (Creative Fill)**：AI 在缺乏指引時，往往會自行捏造或猜測顏色 HEX 碼、間距 (Padding) 或層級 (Z-index) 參數。
2. **硬編碼之災 (Hard-coded Styles)**：未經授權即繞過專案既定的 Design Tokens 直接套用數值，導致全站主題無法統一抽換。
3. **跨專案目錄迷航 (Cross-Project Confusion)**：由於 `moyin-web` 與 `moyin-game-v1` 等子專案具備獨立的 `theme.css` 路徑，AI 經常引用錯置的樣式庫檔案。

上述行為將直接導致：設計系統破壞、重複打回重寫 (Rework) 的無形成本遽增，以及產品維護度的斷崖式下跌。

---

## 2. 核心防線設計原則

### 2.1 強制 Token 對照校準 (Mandatory Token Matching)

嚴格明令：在修改任何 Vue 組件或 HTML 之作用域樣式 (Scoped Style) 前，AI 必須強制讀取對應專案的 `theme.css`。

**查核清單**：

- 顏色 / 背景 / 漸層：`--ui-*`
- 圖層高度 (Z-index)：`--z-*` 抑或 `--ui-z-*`
- 間距 (Margin/Padding/Gap)：`--ui-gap-*`
- 圓角曲度 (Border Radius)：`--ui-radius-*`
- 發光與陰影 (Shadow)：`--ui-shadow-*`
- 轉場時長 (Duration)：`--ui-duration-*`

### 2.2 專案作用域映射表 (Scope Mapping Table)

為防範路徑迷航，本專案建立明確之目錄索引字典。請嚴格對齊專案 SCOPE：

| 子專案 (Sub-project) | `theme.css` 絕對路徑                                        |
| :------------------- | :---------------------------------------------------------- |
| **API 後端中心**     | 無（後端網關專案，強制跳過一切樣式檢查流程）                |
| **moyin-web**        | `projects/moyin-web/src/assets/style/theme.css`             |
| **moyin-game-v1**    | `projects/moyin-game-v1/website/src/assets/style/theme.css` |
| **QA 自動化測試**    | 無（純測試腳本專案，跳過樣式檢查流程）                      |

### 2.3 缺失 Token 攔截與提問協議 (Missing Token ASK Protocol)

若實作過程中發現規格文件要求之樣式並不存在於當前的 `theme.css` 內，AI **必須**阻斷程式並向使用者發起提問 (ASK)：

```markdown
【系統提示】ASK：偵測到目前實作需要下列樣式，然 `theme.css` 中並無對應之 Token：

- background: linear-gradient(...) (建議擴充：`--ui-card-gradient-bg`)
- z-index: 998 (建議擴充：`--z-modal-blocker`)

【請選擇後續處置方針】：
A) 授權予以新增 Token 寫入 `theme.css` (我將於下一步提供擴充代碼草案)。
B) 退而求其次，採用視覺上最相近之現行 Token。
C) 允許本次特例使用硬編碼 (Hard-code)，但我會自動記錄 TODO 以利後續技術債追蹤。
```

**🚫 絕對禁止之越權行為**：

- ❌ 在未獲使用者明確回覆前，即逕自提交包含硬編碼數值的程式碼。
- ❌ 抱持「先硬刻上去交差，事後再提醒使用者重構為 Token」的僥倖行為。

### 2.4 零容忍創造性填充矩陣 (Anti-Hallucination Matrix)

請熟記下列觸發 ASK 提問程序的標準情境：

| 邊界情境 (Edge Condition)                        | 標準作業程序 (SOP)                               |
| :----------------------------------------------- | :----------------------------------------------- |
| UI 規格文檔未具體定義某按鈕之位置或絕對尺寸      | 攔截並 **ASK 用戶** 補充缺失規格                 |
| `theme.css` 缺乏適配該屬性之 Token               | 攔截並 **ASK 用戶** 裁示擴充或妥協方案           |
| 開發規格與設計 Token 庫存在數值衝突              | 攔截並 **ASK 用戶** 請求最高裁量權               |
| 不確定該區塊是否應具備 RWD 響應式斷點 (如 md/lg) | 攔截並 **ASK 用戶** 確認行動端與桌面端之陳列邏輯 |
| 當前 SCOPE 無佈建 theme.css 檔案卻接到排版需求   | 攔截並 **ASK 用戶** 是否予以初始化建立該樣式檔   |

---

## 3. 實戰示範 (Code & Workflow Examples)

### 3.1 規劃階段 (PLAN) 之樣式依賴宣告

在您進入實際編寫程式碼的 `ACTION` 階段前，請於您的分析計畫中明列您即將動用的樣式資源：

```markdown
## PLAN：修復 VN Stage 面板失焦之視覺錯誤

**目標 SCOPE**: moyin-game-v1

**宣告即將套用之樣式依賴 (Tokens)**：

- `--ui-primary` (主色調)
- `--ui-panel` (面板半透明背景)
- `--ui-gap-md` (模組間距)
- `--ui-radius-md` (標準圓角)

**規格對照引用**：`projects/moyin-game-v1/docs/2.DESIGN/2.4.UI_1.1.SPEC.md`
**預計樣式新增**：無 (經核對，所有依賴 Token 均已就緒)
```

---

## 4. 相關連結與延伸閱讀

- [`05_style_guard.md`](../../../.agent/rules/05_style_guard.md) - 樣式規格閘門規則之機器判讀指令版。
- [`03_coding_rules.md`](../../../.agent/rules/03_coding_rules.md) - 全域編碼與 CSS 規範總綱。
- [`theme.css`](../../../projects/moyin-game-v1/website/src/assets/style/theme.css) - `moyin-game-v1` 之具體設計 Token 實體庫。

---

_本文檔由 Moyin 架構知識庫系統自動生成與維護_
